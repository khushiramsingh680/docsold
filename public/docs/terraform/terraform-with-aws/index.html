
<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.122.0">
<link rel="alternate" type="application/rss&#43;xml" href="/docs/terraform/terraform-with-aws/index.xml">
<meta name="robots" content="index, follow">

<link rel="shortcut icon" href="/favicons/favicon.ico" >

<title>Terraform with AWS | Documentation</title>
<meta name="description" content="Part 1">
<meta property="og:title" content="Terraform with AWS" />
<meta property="og:description" content="Part 1" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/terraform/terraform-with-aws/" />

<meta itemprop="name" content="Terraform with AWS">
<meta itemprop="description" content="Part 1"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Terraform with AWS"/>
<meta name="twitter:description" content="Part 1"/>




<link rel="preload" href="/scss/main.min.723d31f72c8542b0efd4dc916a8b429bb3241885d5c0984bf341c1aad66aed50.css" as="style">
<link href="/scss/main.min.723d31f72c8542b0efd4dc916a8b429bb3241885d5c0984bf341c1aad66aed50.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css"/>
<script type="text/javascript"  src="/js/highlight-search.js"></script>
<script type="text/javascript"  src="/js/manage-side-panels.js"></script>
  </head>
  <body class="td-section highlightable">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="217pt" height="232pt" viewBox="0 0 217 232"><g transform="translate(0.000000,232.000000) scale(0.100000,-0.100000)" fill="#000" stroke="none"><path d="M1017 2250c-397-48-698-367-731-775-9-106-3-113 66-87l55 20 11-71c6-39 10-72 9-73s-58-22-127-47c-104-37-124-48-122-64 7-37 56-150 88-205l34-56 66 25 66 26 65-72c206-226 513-322 808-252 367 88 634 417 635 784 0 43-4 77-10 77-5 0-32-9-60-20s-55-20-59-20c-5 0-12 26-16 59-4 32-20 96-36 142s-30 88-31 92c-2 5 54 29 124 55l128 46-31 55c-17 31-33 58-34 59-2 2-31-6-64-19l-61-22-23 29c-81 104-172 178-292 235-140 68-309 97-458 79zm226-299c90-24 136-46 206-101l52-41 61 20 60 20 26-31c15-17 35-44 44-59l17-28-52-19c-29-11-86-32-128-47l-76-27 24-58c26-66 43-144 43-201 0-22 2-39 5-39 2 0 27 9 55 20s55 20 60 20c17 0 10-63-14-131-127-359-580-484-862-237l-35 31-70-24-71-24-30 35c-37 43-97 164-104 212l-6 34 123 46 124 45-3 64c-2 35-5 66-7 68-2 1-27-5-55-14s-53-15-55-14c-2 2 1 29 7 59 32 179 185 352 361 409 112 36 192 39 3e2 12z"/><path d="M134 321c-77-33-95-169-29-231 19-18 36-23 71-23 40 0 51 4 75 30 50 56 47 153-5 202-26 25-80 35-112 22zm82-62c26-29 26-99 0-128-24-26-47-27-77-2-19 15-24 29-24 64 0 76 58 114 101 66z"/><path d="M1172 320c-27-12-44-52-33-82 4-12 31-32 61-47 30-14 58-34 64-43 26-43-50-76-99-44-15 10-26 12-30 6-10-16 4-29 44-40 62-17 114 13 114 65 0 35-19 53-80 81-54 23-67 46-41 72 15 15 62 16 88 2 23-12 35 3 16 19-20 17-77 23-104 11z"/><path d="M350 195V70h25c23 0 25 4 25 45v45h40c76 0 115 40 103 104-8 42-38 56-120 56h-73V195zm134 69c18-18 18-17 10-38-4-11-19-16-50-16-44 0-44 0-44 35 0 33 2 35 34 35 19 0 42-7 50-16z"/><path d="M6e2 195V70h90c83 0 90 2 90 20 0 16-8 19-62 22-63 3-63 3-66 36-3 31-2 32 36 32 36 0 39 2 34 25-4 21-10 25-38 25-30 0-34 3-34 25 0 24 2 25 65 25 58 0 65 2 65 20 0 19-7 20-90 20h-90V195z"/><path d="M850 195c0-117 1-125 20-125 17 0 19 8 22 83l3 82 55-82c41-62 61-83 78-83 22 0 22 2 22 125 0 117-1 125-20 125-17 0-19-8-22-82l-3-82-54 82c-42 65-59 82-77 82-24 0-24 0-24-125z"/><path d="M1360 195c0-104 2-125 15-125 12 0 15 13 15 60v60h65 65v-60c0-47 3-60 15-60 13 0 15 21 15 125s-2 125-15 125c-12 0-15-13-15-55v-55h-65-65v55c0 42-3 55-15 55-13 0-15-21-15-125z"/><path d="M1620 195c0-104 2-125 15-125s15 21 15 125-2 125-15 125-15-21-15-125z"/><path d="M1730 195c0-77 4-125 10-125s10 27 10 60v60h35c19 0 35 5 35 10 0 6-16 10-35 10-35 0-35 0-35 45v45h60c33 0 60 4 60 10s-30 10-70 10h-70V195z"/><path d="M1930 310c0-5 18-10 40-10h40V185c0-70 4-115 10-115s10 45 10 115v115h40c22 0 40 5 40 10 0 6-37 10-90 10s-90-4-90-10z"/></g></svg></span><span class="font-weight-bold">Documentation</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/kubernetes/" ><i class='fas fa-binoculars'></i><span>KUBERNETES DOCUMENTS</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/ansible/" ><i class='fas fa-user-check'></i><span>Ansible</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/azure-devops/" ><i class='fas fa-user-check'></i><span>Azure Devops</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/devops/" ><i class='fas fa-user-check'></i><span>Devops </span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/gitlab/" ><i class='fas fa-user-check'></i><span>Gitlab</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/openshift/" ><i class='fas fa-user-check'></i><span>Openshift</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/docs/terraform/" ><i class='fas fa-user-check'></i><span class="active">Terraform</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
<form class="d-flex align-items-center">
  <input type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.d81df5ea3c42d7ddf1c407fed2af5e96.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="20">
</form>
</div>
</nav>

      <div class="manage-panels">
    <button type="button" class="button-left" id="left-panel-manager" title="Hide sidebar">""</button>
    <button type="button" class="button-right" id="right-panel-manager" title="Hide sidebar">""</button>
</div>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main autonumbering">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            
<div id="td-sidebar-menu" class="td-sidebar__inner">
  <div id="content-mobile">
  <form class="td-sidebar__search d-flex align-items-center">
    
<form class="d-flex align-items-center">
  <input type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.d81df5ea3c42d7ddf1c407fed2af5e96.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="20">
</form>

    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  </div>
  <div id="content-desktop"></div>
  <nav class="collapse td-sidebar-nav foldable-nav" id="td-section-nav">
    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docs-li">
  <a href="/docs/" title="DEVOPS Documents hub" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-docs"><span class="">Docs</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docskubernetes-li">
  <input type="checkbox" id="m-docskubernetes-check"/>
  <label for="m-docskubernetes-check"><a href="/docs/kubernetes/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docskubernetes"><i class="fas fa-compass"></i><span class="">KUBERNETES DOCUMENTS</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetespart01-li">
  <input type="checkbox" id="m-docskubernetespart01-check"/>
  <label for="m-docskubernetespart01-check"><a href="/docs/kubernetes/part01/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetespart01"><span class="">Part 1</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetespart02-li">
  <input type="checkbox" id="m-docskubernetespart02-check"/>
  <label for="m-docskubernetespart02-check"><a href="/docs/kubernetes/part02/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetespart02"><span class="">Part 2</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetespart03-li">
  <input type="checkbox" id="m-docskubernetespart03-check"/>
  <label for="m-docskubernetespart03-check"><a href="/docs/kubernetes/part03/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetespart03"><span class="">Part 3</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetespart04-li">
  <input type="checkbox" id="m-docskubernetespart04-check"/>
  <label for="m-docskubernetespart04-check"><a href="/docs/kubernetes/part04/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetespart04"><span class="">Part 4</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetespart05-li">
  <input type="checkbox" id="m-docskubernetespart05-check"/>
  <label for="m-docskubernetespart05-check"><a href="/docs/kubernetes/part05/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetespart05"><span class="">Part 5</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetesdocsmiscellaneouscontainerbasics-li">
  <input type="checkbox" id="m-docskubernetesdocsmiscellaneouscontainerbasics-check"/>
  <label for="m-docskubernetesdocsmiscellaneouscontainerbasics-check"><a href="/docs/kubernetes/docs/miscellaneous/containerbasics/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetesdocsmiscellaneouscontainerbasics"><span class="">Container Basics</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetesdocsmiscellaneoushelm-overview-li">
  <input type="checkbox" id="m-docskubernetesdocsmiscellaneoushelm-overview-check"/>
  <label for="m-docskubernetesdocsmiscellaneoushelm-overview-check"><a href="/docs/kubernetes/docs/miscellaneous/helm-overview/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetesdocsmiscellaneoushelm-overview"><span class="">Helm Overview</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetesdocsmiscellaneouskubernetes-rbac-li">
  <input type="checkbox" id="m-docskubernetesdocsmiscellaneouskubernetes-rbac-check"/>
  <label for="m-docskubernetesdocsmiscellaneouskubernetes-rbac-check"><a href="/docs/kubernetes/docs/miscellaneous/kubernetes-rbac/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetesdocsmiscellaneouskubernetes-rbac"><span class="">Kubernetes RBAC</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetesdocsmiscellaneouskubernetes-on-centos-li">
  <input type="checkbox" id="m-docskubernetesdocsmiscellaneouskubernetes-on-centos-check"/>
  <label for="m-docskubernetesdocsmiscellaneouskubernetes-on-centos-check"><a href="/docs/kubernetes/docs/miscellaneous/kubernetes-on-centos/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetesdocsmiscellaneouskubernetes-on-centos"><span class="">Kubernetes-on-Centos</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetesdocsmiscellaneouskuberneteshardway-li">
  <input type="checkbox" id="m-docskubernetesdocsmiscellaneouskuberneteshardway-check"/>
  <label for="m-docskubernetesdocsmiscellaneouskuberneteshardway-check"><a href="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetesdocsmiscellaneouskuberneteshardway"><span class="">Kubernets Installation From Scatch on rocky 9</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetesdocsmiscellaneousminio-li">
  <input type="checkbox" id="m-docskubernetesdocsmiscellaneousminio-check"/>
  <label for="m-docskubernetesdocsmiscellaneousminio-check"><a href="/docs/kubernetes/docs/miscellaneous/minio/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetesdocsmiscellaneousminio"><span class="">The Object Store for AI Data Infrastructure</span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsansible-li">
  <input type="checkbox" id="m-docsansible-check"/>
  <label for="m-docsansible-check"><a href="/docs/ansible/" title="Configuration Management Tool" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsansible"><i class="fas fa-user-check"></i><span class="">Ansible</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsazure-devops-li">
  <input type="checkbox" id="m-docsazure-devops-check"/>
  <label for="m-docsazure-devops-check"><a href="/docs/azure-devops/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsazure-devops"><i class="fas fa-user-check"></i><span class="">Azure Devops</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsazure-devopsaks-deployment-li">
  <input type="checkbox" id="m-docsazure-devopsaks-deployment-check"/>
  <label for="m-docsazure-devopsaks-deployment-check"><a href="/docs/azure-devops/aks-deployment/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsazure-devopsaks-deployment"><span class="">AKS Deployment</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsazure-devopsazure-container-registry-li">
  <input type="checkbox" id="m-docsazure-devopsazure-container-registry-check"/>
  <label for="m-docsazure-devopsazure-container-registry-check"><a href="/docs/azure-devops/azure-container-registry/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsazure-devopsazure-container-registry"><span class="">Azure Container Registry</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsazure-devopsazure-devopsagent-li">
  <input type="checkbox" id="m-docsazure-devopsazure-devopsagent-check"/>
  <label for="m-docsazure-devopsazure-devopsagent-check"><a href="/docs/azure-devops/azure-devopsagent/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsazure-devopsazure-devopsagent"><span class="">Azure Devops Pipeline Agent</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsazure-devopsazure-devops-pipeline-li">
  <input type="checkbox" id="m-docsazure-devopsazure-devops-pipeline-check"/>
  <label for="m-docsazure-devopsazure-devops-pipeline-check"><a href="/docs/azure-devops/azure-devops-pipeline/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsazure-devopsazure-devops-pipeline"><span class="">Azure Devops Pipeline Basics</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsazure-devopsazure-dns-li">
  <input type="checkbox" id="m-docsazure-devopsazure-dns-check"/>
  <label for="m-docsazure-devopsazure-dns-check"><a href="/docs/azure-devops/azure-dns/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsazure-devopsazure-dns"><span class="">Azure DNS</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsazure-devopscertmanager-li">
  <input type="checkbox" id="m-docsazure-devopscertmanager-check"/>
  <label for="m-docsazure-devopscertmanager-check"><a href="/docs/azure-devops/certmanager/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsazure-devopscertmanager"><span class="">Cert Manager</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsazure-devopsingresscontroller-li">
  <input type="checkbox" id="m-docsazure-devopsingresscontroller-check"/>
  <label for="m-docsazure-devopsingresscontroller-check"><a href="/docs/azure-devops/ingresscontroller/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsazure-devopsingresscontroller"><span class="">IngressController</span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsdevops-li">
  <input type="checkbox" id="m-docsdevops-check"/>
  <label for="m-docsdevops-check"><a href="/docs/devops/" title="Devops" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsdevops"><i class="fas fa-user-check"></i><span class="">Devops </span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdevopsdevops-advance-li">
  <input type="checkbox" id="m-docsdevopsdevops-advance-check"/>
  <label for="m-docsdevopsdevops-advance-check"><a href="/docs/devops/devops-advance/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsdevopsdevops-advance"><span class="">Devops for Advance Level</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdevopsdevopsl1-li">
  <input type="checkbox" id="m-docsdevopsdevopsl1-check"/>
  <label for="m-docsdevopsdevopsl1-check"><a href="/docs/devops/devopsl1/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsdevopsdevopsl1"><span class="">Devops for Begineers</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdevopselk-stack-li">
  <input type="checkbox" id="m-docsdevopselk-stack-check"/>
  <label for="m-docsdevopselk-stack-check"><a href="/docs/devops/elk-stack/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsdevopselk-stack"><span class="">ELK statck </span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdevopspostgresql-li">
  <input type="checkbox" id="m-docsdevopspostgresql-check"/>
  <label for="m-docsdevopspostgresql-check"><a href="/docs/devops/postgresql/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsdevopspostgresql"><span class="">Postgres Installation </span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsgitlab-li">
  <input type="checkbox" id="m-docsgitlab-check"/>
  <label for="m-docsgitlab-check"><a href="/docs/gitlab/" title="Project Management Tool" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsgitlab"><i class="fas fa-user-check"></i><span class="">Gitlab</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docsterraform-li">
  <input type="checkbox" id="m-docsterraform-check" checked/>
  <label for="m-docsterraform-check"><a href="/docs/terraform/" title="Infrastracture as a Code" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsterraform"><i class="fas fa-user-check"></i><span class="">Terraform</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsterraformdiscussions-li">
  <input type="checkbox" id="m-docsterraformdiscussions-check"/>
  <label for="m-docsterraformdiscussions-check"><a href="/docs/terraform/discussions/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsterraformdiscussions"><span class="">Discussions</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsterraformterraform-with-aws-li">
  <input type="checkbox" id="m-docsterraformterraform-with-aws-check"/>
  <label for="m-docsterraformterraform-with-aws-check"><a href="/docs/terraform/terraform-with-aws/" class="align-left pl-0  active td-sidebar-link td-sidebar-link__section" id="m-docsterraformterraform-with-aws"><span class="td-sidebar-nav-active-item">Terraform with AWS</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsterraformterraform-with-azure-li">
  <input type="checkbox" id="m-docsterraformterraform-with-azure-check"/>
  <label for="m-docsterraformterraform-with-azure-check"><a href="/docs/terraform/terraform-with-azure/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsterraformterraform-with-azure"><span class="">Terraform with Azure</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsterraformterraform-with-gcp-li">
  <input type="checkbox" id="m-docsterraformterraform-with-gcp-check"/>
  <label for="m-docsterraformterraform-with-gcp-check"><a href="/docs/terraform/terraform-with-gcp/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsterraformterraform-with-gcp"><span class="">Terraform with Google Cloud</span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsopenshift-li">
  <input type="checkbox" id="m-docsopenshift-check"/>
  <label for="m-docsopenshift-check"><a href="/docs/openshift/" title="Redhat Container Platform" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsopenshift"><i class="fas fa-user-check"></i><span class="">Openshift</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshiftopenshift-baremetalmd-li">
  <input type="checkbox" id="m-docsopenshiftopenshift-baremetalmd-check"/>
  <label for="m-docsopenshiftopenshift-baremetalmd-check"><a href="/docs/openshift/openshift-baremetal.md/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshiftopenshift-baremetalmd"><span class="">Openshift Baremetal</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshiftocpsetup-li">
  <input type="checkbox" id="m-docsopenshiftocpsetup-check"/>
  <label for="m-docsopenshiftocpsetup-check"><a href="/docs/openshift/ocpsetup/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshiftocpsetup"><span class="">Openshift Installation and Upgradation</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshiftprerequisites-li">
  <input type="checkbox" id="m-docsopenshiftprerequisites-check"/>
  <label for="m-docsopenshiftprerequisites-check"><a href="/docs/openshift/prerequisites./" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshiftprerequisites"><span class="">OpenShift Prerequisites</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshiftopenshifttasks-li">
  <input type="checkbox" id="m-docsopenshiftopenshifttasks-check"/>
  <label for="m-docsopenshiftopenshifttasks-check"><a href="/docs/openshift/openshifttasks/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshiftopenshifttasks"><span class="">OpenShift Tasks</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshifttoc-li">
  <input type="checkbox" id="m-docsopenshifttoc-check"/>
  <label for="m-docsopenshifttoc-check"><a href="/docs/openshift/toc/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshifttoc"><span class="">Openshift TOC</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshiftpart-1-li">
  <input type="checkbox" id="m-docsopenshiftpart-1-check"/>
  <label for="m-docsopenshiftpart-1-check"><a href="/docs/openshift/part-1/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshiftpart-1"><span class="">Part 1</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshiftpart-2-li">
  <input type="checkbox" id="m-docsopenshiftpart-2-check"/>
  <label for="m-docsopenshiftpart-2-check"><a href="/docs/openshift/part-2/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshiftpart-2"><span class="">Part 2</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshiftopenid-azuread-li">
  <input type="checkbox" id="m-docsopenshiftopenid-azuread-check"/>
  <label for="m-docsopenshiftopenid-azuread-check"><a href="/docs/openshift/openid-azuread/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshiftopenid-azuread"><span class="">Use and configure OpenID connect with Azure AD</span></a></label>
  
</li>
  </ul>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            

    <div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
        <div class="toc-title">Actions</div>
        <a href="/edit/master/content/docs/Terraform/Terraform%20with%20AWS/_index.md" target="_blank" rel="noopener"><i class="fa fa-edit fa-fw"></i> Contribute to this page</a>
        <a href="/issues/new?issue%5Btitle=%f0%9f%93%83%20docs:%20update%20page%20docs/Terraform/Terraform%20with%20AWS/_index.md" target="_blank" rel="noopener"><i class="fab fa-gitlab fa-fw"></i> Create a documentation issue</a>
       
    </div>

            
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0 right-menu-toc">

    
        
            <div class="toc-title">Table of content</div>
            <div class="td-toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#topics">Topics</a>
      <ul>
        <li>
          <ul>
            <li><a href="#prerequisites-tasks">Prerequisites Tasks</a></li>
          </ul>
        </li>
        <li><a href="#prerequisites-tools">Prerequisites Tools</a></li>
        <li><a href="#iac">IAC</a></li>
        <li><a href="#terraform-alternatives">Terraform Alternatives</a></li>
        <li><a href="#terraform--provider">Terraform  Provider</a></li>
        <li><a href="#provider-requirementsterraform-block">Provider Requirements(Terraform Block)</a></li>
        <li><a href="#terraform-block">Terraform Block</a>
          <ul>
            <li><a href="#terraform-block-1">Terraform Block</a></li>
            <li><a href="#provide-block">Provide Block</a></li>
            <li><a href="#data-block">Data Block</a></li>
            <li><a href="#resource-block">Resource Block</a></li>
          </ul>
        </li>
        <li><a href="#authentication-and-configuration">Authentication and Configuration</a></li>
        <li><a href="#terraform-language">Terraform Language</a>
          <ul>
            <li><a href="#random-provider">Random Provider</a></li>
          </ul>
        </li>
        <li><a href="#getting-started-with-local-provider">Getting Started with Local Provider</a>
          <ul>
            <li><a href="#local-provider">Local Provider</a></li>
          </ul>
        </li>
        <li><a href="#getting-started-with-aws-provider">Getting started with AWS Provider</a>
          <ul>
            <li><a href="#data-sources-examples">Data Sources Examples</a></li>
            <li><a href="#terraform-meta-arguments">Terraform Meta Arguments</a>
              <ul>
                <li><a href="#depends_on">Depends_on</a></li>
                <li><a href="#lifecycle">LifeCycle</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#topics-to-be-covered">Topics to be covered</a>
          <ul>
            <li><a href="#variables">Variables</a></li>
            <li><a href="#loading-variables-automatically">Loading variables automatically</a>
              <ul>
                <li><a href="#how-to-use-terraform-resource-meta-arguments">How to use Terraform resource meta arguments?</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#table-of-content">Table of Content</a>
          <ul>
            <li>
              <ul>
                <li><a href="#how-to-use-terraform-locals">How to use Terraform locals?</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#conditions">Conditions</a></li>
        <li><a href="#terraform-output">Terraform Output:</a></li>
        <li><a href="#terraform-workspace">Terraform Workspace</a></li>
        <li><a href="#terraform-provisioner">Terraform Provisioner</a>
          <ul>
            <li><a href="#local-exec">Local Exec</a></li>
          </ul>
        </li>
        <li><a href="#terraform-provisioner-1">Terraform Provisioner</a>
          <ul>
            <li><a href="#remote-exec">Remote Exec</a></li>
          </ul>
        </li>
        <li><a href="#-dynamic-blocks">##### Dynamic Blocks</a>
          <ul>
            <li><a href="#testing-with-null-resoures">Testing with null resoures</a>
              <ul>
                <li><a href="#conditions-1">Conditions</a></li>
              </ul>
            </li>
            <li><a href="#transformation">Transformation</a>
              <ul>
                <li><a href="#local-exec-1">Local Exec</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#terraform-provisioner-2">Terraform Provisioner</a>
          <ul>
            <li><a href="#remote-exec-1">Remote Exec</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
        
    

</div>
          </aside>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="/docs/">Docs</a>
  </li>
  <li class="breadcrumb-item">
    <a href="/docs/terraform/">Terraform</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">
    <a href="/docs/terraform/terraform-with-aws/">Terraform with AWS</a>
  </li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>Terraform with AWS</h1>
  <div class="lead">Part 1</div>
	<header class="article-meta">
		

  
    


  
    


  

		
	</header>
	<!-- end-chunk -->
<!-- begin-chunk data-anchor="topics" data-heading="Topics" data-level="2" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h2 id="topics">Topics</h2><ul>
<li>
<p>Overview of Git</p>
</li>
<li>
<p>What is IAC ?</p>
</li>
<li>
<p>Terraform Overview</p>
<ul>
<li>What is Terraform ?</li>
<li>Terraform Editions</li>
<li>Core terraform workflow</li>
<li>Phases of Terraform adoption.</li>
</ul>
</li>
<li>
<p>Terraform Alternatives</p>
<ul>
<li>Ansible</li>
<li>AWS Cloudformarion</li>
<li>Azurerm template</li>
<li>Google deployment manager</li>
</ul>
</li>
<li>
<p>OverView of AWS Cloud</p>
<ul>
<li>Walk through many services from AWS UI.
<ul>
<li>Get Started - AWS</li>
<li>Regions and Availablity Zone</li>
<li>AWS IAM</li>
<li>AWS Ec2 instance</li>
<li>VPC</li>
<li>RDS  etc many more</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Lab Set up</p>
<ul>
<li>Installation of Terraform on different os windows/Linux</li>
<li>Installation of AWS Cli on Linux/Wndows</li>
<li>Installation of Vscode to develop the code</li>
<li>Installation of Gitbash to push and pull code to Git repo(Gitlab/Github).</li>
</ul>
</li>
<li>
<p>Overview of HCL (Hashicorp Configiguration Language)</p>
</li>
<li>
<p>Terraform Block</p>
</li>
<li>
<p>Terraform Providers</p>
<ul>
<li>AzureRM</li>
<li>Local</li>
<li>random</li>
<li>null</li>
</ul>
</li>
<li>
<p>Terraform Resources and DataSources</p>
</li>
<li>
<p>Hashicop Configuration Language</p>
<ul>
<li>Blocks</li>
<li>Arguments</li>
<li>Comments</li>
<li>Identifiers</li>
</ul>
</li>
<li>
<p>Resource Blocks</p>
</li>
<li>
<p>Meta-Arguments</p>
<ul>
<li>depends_on</li>
<li>count</li>
<li>for_each</li>
<li>provider</li>
<li>lifecycle</li>
</ul>
</li>
<li>
<p>Terraform Variables</p>
<ul>
<li>Input Variables
<ul>
<li>Prompt Vriables</li>
<li>Optional Variables</li>
<li>Variables Validation</li>
<li>Data Type of Variables:
<ul>
<li>String</li>
<li>Numbers</li>
<li>Booleans</li>
<li>Object</li>
</ul>
</li>
<li>Type of Variables
<ul>
<li>Scaler</li>
<li>List</li>
<li>Map</li>
<li>Tuple</li>
<li>set</li>
</ul>
</li>
<li>Change variables values using different ways
<ul>
<li>At runtime</li>
<li>with tfvars file</li>
</ul>
</li>
<li>Defining variable using Terraform environment variables</li>
</ul>
</li>
<li>Output values</li>
<li>local Values</li>
</ul>
</li>
<li>
<p>Terraform State Management</p>
<ul>
<li>Local file</li>
<li>Lock in state file</li>
<li>State management on cloud storage</li>
<li>Pull and push state file</li>
<li>update state file</li>
</ul>
</li>
<li>
<p>Terraform Workspace</p>
<ul>
<li>Managing multiple environment with workspace</li>
</ul>
</li>
<li>
<p>Terraform Provisioners</p>
<ul>
<li>Local</li>
<li>file</li>
<li>Remote-exec</li>
</ul>
</li>
<li>
<p>Terraform Module</p>
<ul>
<li>Local Module</li>
<li>remote module</li>
<li>Publish module on Terraform Registry</li>
</ul>
</li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="prerequisites-tasks" data-heading="Prerequisites Tasks" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="prerequisites-tasks">Prerequisites Tasks</h4><ul>
<li>Create AWS free Account</li>
<li>Walk through AWS Console</li>
<li>Understand IAM Account (Identity and Access Management)</li>
<li>Create users and role</li>
<li>Download and Install aws cli</li>
<li>Configure Aws cli</li>
<li>Configure Aws resources using aws Cli</li>
<li>Using Profile with Aws cli</li>
<li>Creating AWS ec2 instance from Aws console</li>
<li>Creating ssh key and try to access using key</li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="prerequisites-tools" data-heading="Prerequisites Tools" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="prerequisites-tools">Prerequisites Tools</h3><ul>
<li>Install vscode on your Laptop using below click</li>
<li><a href="https://code.visualstudio.com/download" target="_blank" rel="noopener"> Click here to download vscode</a></li>
<li>Install gitbash on your Laptop</li>
<li><a href="https://git-scm.com/downloads" target="_blank" rel="noopener"> Click here to download gitbash</a></li>
<li>Install Terraform on your Laptop</li>
<li><a href="https://www.terraform.io/downloads.html" target="_blank" rel="noopener"> Click here to download Terraform</a></li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="iac" data-heading="IAC" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="iac">IAC</h3><ul>
<li>
<p>Infrastructure as Code (IaC) tools allow you to manage infrastructure with configuration files rather than through a graphical user interface.</p>
</li>
<li>
<p>IaC allows you to build, change, and manage your infrastructure in a safe, consistent, and repeatable way by defining resource configurations that you can version, reuse, and share.</p>
</li>
<li>
<p>Terraform is HashiCorp&rsquo;s infrastructure as code tool.</p>
</li>
<li>
<p>It lets you define resources and infrastructure in human-readable, declarative configuration files, and manages your infrastructure&rsquo;s lifecycle.</p>
</li>
<li>
<p>Using Terraform has several advantages over manually managing your infrastructure:</p>
<ul>
<li>Terraform can manage infrastructure on multiple cloud platforms.</li>
<li>The human-readable configuration language helps you write infrastructure code quickly.</li>
<li>Terraform&rsquo;s state allows you to track resource changes throughout your deployments.</li>
<li>You can commit your configurations to version control to safely collaborate on infrastructure.</li>
</ul>
</li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="terraform-alternatives" data-heading="Terraform Alternatives" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="terraform-alternatives">Terraform Alternatives</h3><ul>
<li>Ansible</li>
<li>AWS Cloudformation</li>
<li>Azure Arm Template</li>
<li>Google deployment manager</li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="terraform--provider" data-heading="Terraform  Provider" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="terraform--provider">Terraform  Provider</h3><p>Terraform plugins called providers let Terraform interact with cloud platforms and other services via their application programming interfaces (APIs).</p>
<p><img src="/images/tprovider01.png" alt="">
HashiCorp and the Terraform community have written over 1,000 providers to manage resources on Amazon Web Services (AWS), Azure, Google Cloud Platform (GCP), Kubernetes, Helm, GitHub, Splunk, and DataDog, just to name a few.</p>
<p>Find providers for many of the platforms and services you already use in the <a href="https://registry.terraform.io/browse/providers" target="_blank" rel="noopener">Terraform Registry.</a></p>
<ul>
<li>Use the Amazon Web Services (AWS) provider to interact with the many resources supported by AWS.</li>
<li>You must configure the provider with the proper credentials before you can use it.</li>
<li>There are currently 1332 resources and 544 data sources available in the provider.</li>
<li>Example Provider configuration</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span><span style="color:#75715e"># The default provider configuration; resources that begin with `aws_` will use</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># it as the default, and it can be referenced as `aws`.</span>
</span></span><span style="display:flex;"><span>provider <span style="color:#e6db74">&#34;aws&#34;</span> {
</span></span><span style="display:flex;"><span>  region <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-east-1&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Additional provider configuration for west coast region; resources can</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># reference this as `aws.west`.</span>
</span></span><span style="display:flex;"><span>provider <span style="color:#e6db74">&#34;aws&#34;</span> {
</span></span><span style="display:flex;"><span>  alias  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;west&#34;</span>
</span></span><span style="display:flex;"><span>  region <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-west-2&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="provider-requirementsterraform-block" data-heading="Provider Requirements(Terraform Block)" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="provider-requirementsterraform-block">Provider Requirements(Terraform Block)</h3><p>-Each Terraform module must declare which providers it requires, so that Terraform can install and use them. Provider requirements are declared in a required_providers block.</p>
<ul>
<li>A provider requirement consists of a local name, a source location, and a version constraint:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform {
</span></span><span style="display:flex;"><span>  required_providers {
</span></span><span style="display:flex;"><span>    mycloud <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      source  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mycorp/mycloud&#34;</span>
</span></span><span style="display:flex;"><span>      version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;~&gt; 1.0&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p><strong>source</strong> - the global source address for the provider you intend to use, such as hashicorp/aws.</p>
</li>
<li>
<p><strong>version</strong> - a version constraint specifying which subset of available provider versions the module is compatible with.</p>
</li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="terraform-block" data-heading="Terraform Block" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="terraform-block">Terraform Block</h3><ul>
<li>Terraform Block</li>
<li>Provider Block</li>
<li>Data Block</li>
<li>Resource Block</li>
<li>Module Block</li>
<li>Variable Block</li>
<li>Output Block</li>
<li>Locals Block</li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="terraform-block-1" data-heading="Terraform Block" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="terraform-block-1">Terraform Block</h4><ul>
<li>It is used to define global configuration and behavior for terraform execution.</li>
<li>Setting the required Terraform version.</li>
<li>Configuring the backend for storing the state file.</li>
<li>Defining experimental or optional features.</li>
<li>Specifying variables used across multiple modules or configurations.</li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="provide-block" data-heading="Provide Block" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="provide-block">Provide Block</h4><p>The provider block is used to configure and define the provider for a specific cloud or infrastructure program,It specifies details such as the provider name and version, authentication credentials, and other settings. By correctly configuring the provider block, you ensure that Terraform knows which provider to use and how to authenticate with it.</p>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="data-block" data-heading="Data Block" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="data-block">Data Block</h4><p>This block is used to fetch data from external sources or existing resources. we can use a data block to fetch information about existing resources, such as a list of available AWS AMIs or the currently existing state of a Kubernetes cluster. By utilizing data blocks, you can incorporate external data into your infrastructure configuration and make informed decisions based on that information.</p>
<ul>
<li>Retrieving information about existing infrastructure to be used in the Terraform configuration.</li>
<li>Querying and filtering data for use in resource configuration.</li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="resource-block" data-heading="Resource Block" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="resource-block">Resource Block</h4><p>It is used to declare and define the provider for a specific cloud or infrastructure program. Resources represent components such as virtual machines, networks, storage, databases, and other services. Each resource block specifies the resource type, name, and configuration parameters specific to that resource. By using resource blocks effectively, we can create and manage the desired infrastructure resources in a consistent and repeatable manner.</p>
<ul>
<li>Configuring the properties and attributes of the resources.</li>
<li>Specifying dependencies and relationships between resources.</li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="authentication-and-configuration" data-heading="Authentication and Configuration" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="authentication-and-configuration">Authentication and Configuration</h3><p>Configuration for the AWS Provider can be derived from several sources, which are applied in the following order:</p>
<ul>
<li>
<p>Parameters in the provider configuration</p>
</li>
<li>
<p>Environment variables</p>
</li>
<li>
<p>Shared credentials files</p>
</li>
<li>
<p>Shared configuration files</p>
</li>
<li>
<p>Container credentials</p>
</li>
<li>
<p>Instance profile credentials and Region</p>
</li>
<li>
<p>Configure Authentication with Roles on Ec2 Instance</p>
</li>
<li>
<p>Configure Authentication with static Credentials</p>
</li>
<li>
<p>Create a file with name provider.tf (not mandatory)</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>provider <span style="color:#e6db74">&#34;aws&#34;</span> {
</span></span><span style="display:flex;"><span>  region     <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-west-2&#34;</span>
</span></span><span style="display:flex;"><span>  access_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;my-access-key&#34;</span>
</span></span><span style="display:flex;"><span>  secret_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;my-secret-key&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Configure Authentication with Environment variable</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span> export AWS_ACCESS_KEY_ID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;anaccesskey&#34;</span>
</span></span><span style="display:flex;"><span> export AWS_SECRET_ACCESS_KEY<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;asecretkey&#34;</span>
</span></span><span style="display:flex;"><span> export AWS_DEFAULT_REGION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;us-west-2&#34;</span>
</span></span></code></pre></div><ul>
<li>Configure Authentication with Shared Credentials File</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>provider <span style="color:#e6db74">&#34;aws&#34;</span> {
</span></span><span style="display:flex;"><span>  region                  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-west-2&#34;</span>
</span></span><span style="display:flex;"><span>  shared_credentials_file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/Users/tf_user/.aws/creds&#34;</span>
</span></span><span style="display:flex;"><span>  profile                 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;customprofile&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Create terraform block if you need to define version constraints in the same file where you have defined aws credentials</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform {
</span></span><span style="display:flex;"><span>  required_providers {
</span></span><span style="display:flex;"><span>    aws <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      source <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hashicorp/aws&#34;</span>
</span></span><span style="display:flex;"><span>      version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;3.63.0&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="terraform-language" data-heading="Terraform Language" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="terraform-language">Terraform Language</h3><ul>
<li>The main purpose of the Terraform language is declaring resources, which represent infrastructure objects.</li>
<li>A Terraform configuration is a complete document in the Terraform language that tells Terraform how to manage a given collection of infrastructure.</li>
<li>A configuration can consist of multiple files and directories.</li>
<li>The syntax of the Terraform language consists of only a few basic elements:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_vpc&#34;</span> <span style="color:#e6db74">&#34;main&#34;</span> {
</span></span><span style="display:flex;"><span>  cidr_block <span style="color:#f92672">=</span> var<span style="color:#f92672">.</span>base_cidr_block
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span>BLOCK TYPE<span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#34;&lt;BLOCK LABEL&gt;&#34;</span> <span style="color:#e6db74">&#34;&lt;BLOCK LABEL&gt;&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Block body</span>
</span></span><span style="display:flex;"><span>  Argument <span style="color:#f92672">=</span> vakue <span style="color:#75715e"># Argument</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Blocks are containers for other content and usually represent the configuration of some kind of object, like a resource.</li>
<li>Arguments assign a value to a name. They appear within blocks.</li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="random-provider" data-heading="Random Provider" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="random-provider">Random Provider</h4><ul>
<li>Define random provider</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform {
</span></span><span style="display:flex;"><span>  required_providers {
</span></span><span style="display:flex;"><span>    random <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      source <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hashicorp/random&#34;</span>
</span></span><span style="display:flex;"><span>      version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2.3.0&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="getting-started-with-local-provider" data-heading="Getting Started with Local Provider" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="getting-started-with-local-provider">Getting Started with Local Provider</h3><!-- end-chunk -->
<!-- begin-chunk data-anchor="local-provider" data-heading="Local Provider" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="local-provider">Local Provider</h4><ul>
<li>The Local provider is used to manage local resources, such as files.</li>
<li>It has resources and datasources</li>
<li>Create a provider.tf file for local provider</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform {
</span></span><span style="display:flex;"><span> required_providers {
</span></span><span style="display:flex;"><span>   local <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>     source <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hashicorp/local&#34;</span>
</span></span><span style="display:flex;"><span>     version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2.4.1&#34;</span>
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>provider <span style="color:#e6db74">&#34;local&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#75715e"># Configuration options</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Download local provider plugins</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform init 
</span></span></code></pre></div><ul>
<li>Verify the provider</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform providers
</span></span></code></pre></div><ul>
<li>Create first resource file</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;local_file&#34;</span> <span style="color:#e6db74">&#34;foo&#34;</span> {
</span></span><span style="display:flex;"><span>  content  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo!&#34;</span>
</span></span><span style="display:flex;"><span>  filename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;${path.module}/foo.bar&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Run the above configuration</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform plan
</span></span><span style="display:flex;"><span>terraform apply
</span></span></code></pre></div><p>Above will create a file with the name foo at the same location where we have all our tf files</p>
<ul>
<li>Also check if the file is created ,state file is also created</li>
<li>Check after modifying the files and file name and see what happens.</li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="getting-started-with-aws-provider" data-heading="Getting started with AWS Provider" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="getting-started-with-aws-provider">Getting started with AWS Provider</h3><ul>
<li>Create Terraform Provider file and know about all the parameters</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform {
</span></span><span style="display:flex;"><span>  required_providers {
</span></span><span style="display:flex;"><span>    aws <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      source <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hashicorp/aws&#34;</span>
</span></span><span style="display:flex;"><span>      version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;5.39.0&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>provider <span style="color:#e6db74">&#34;aws&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Configuration options</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p>Configure Authentication we have already discussed erlier</p>
<ul>
<li>Using role</li>
<li>Using Credentials in provider  file</li>
<li>Using Environment Variables</li>
</ul>
</li>
<li>
<p>Create a tf file for ec2 instance</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#f92672">&lt;</span>ami<span style="color:#f92672">-</span>id<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  instance_type = &#34;</span>t2<span style="color:#f92672">.</span>micro<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  tags = {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Name = &#34;</span>HelloWorld<span style="color:#960050;background-color:#1e0010">&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><ul>
<li>Update ssh key</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>ssh<span style="color:#f92672">-</span>keygen <span style="color:#f92672">-</span>f <span style="color:#e6db74">&lt;aws&gt;</span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_key_pair&#34;</span> <span style="color:#e6db74">&#34;key&#34;</span> {
</span></span><span style="display:flex;"><span>    key_name <span style="color:#f92672">=</span>  <span style="color:#e6db74">&#34;own&#34;</span>
</span></span><span style="display:flex;"><span>     
</span></span><span style="display:flex;"><span>    public_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCx66nZKbSRhFqAdO4E283zUvAPmR1zT7gmh0E6jgR5ZIj/cgYcfLW56Nz2lUvifBlxW5ZM+EiuNMjSCIsfSukLLtzqyPkigZHM8EoPEzlKzyBGZq8F8QCe&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>OR</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_key_pair&#34;</span> <span style="color:#e6db74">&#34;key&#34;</span> {
</span></span><span style="display:flex;"><span>    key_name <span style="color:#f92672">=</span>  <span style="color:#e6db74">&#34;own1&#34;</span>
</span></span><span style="display:flex;"><span>     
</span></span><span style="display:flex;"><span>    public_key <span style="color:#f92672">=</span> file(<span style="color:#e6db74">&#34;${path.module}/aws.pub&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Another Example</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_key_pair&#34;</span> <span style="color:#e6db74">&#34;key&#34;</span> {
</span></span><span style="display:flex;"><span>    key_name_prefix <span style="color:#f92672">=</span>  <span style="color:#e6db74">&#34;own1&#34;</span>
</span></span><span style="display:flex;"><span>     
</span></span><span style="display:flex;"><span>    public_key <span style="color:#f92672">=</span> file(<span style="color:#e6db74">&#34;${path.module}/aws.pub&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p>Update instance type</p>
</li>
<li>
<p>Update security group</p>
</li>
<li>
<p>update ebs volume for ec2 instance</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_ebs_volume&#34;</span> <span style="color:#e6db74">&#34;example&#34;</span> {
</span></span><span style="display:flex;"><span>  availability_zone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-west-2a&#34;</span>
</span></span><span style="display:flex;"><span>  size              <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Another example</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web1&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-02e136e904f3da870&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>  availability_zone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-east-1a&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_ebs_volume&#34;</span> <span style="color:#e6db74">&#34;awsvolume&#34;</span> {
</span></span><span style="display:flex;"><span>  availability_zone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-east-1a&#34;</span>
</span></span><span style="display:flex;"><span>  size <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>  encrypted <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;new_volume_mounttoec2&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>update public ip for ec2 instance</li>
<li>Use userdata with ec2 instance</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web1&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-02e136e904f3da870&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>  availability_zone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-east-1a&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_ebs_volume&#34;</span> <span style="color:#e6db74">&#34;awsvolume&#34;</span> {
</span></span><span style="display:flex;"><span>  availability_zone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-east-1a&#34;</span>
</span></span><span style="display:flex;"><span>  size <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>  encrypted <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;new_volume_mounttoec2&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_volume_attachment&#34;</span> <span style="color:#e6db74">&#34;namenews&#34;</span> {
</span></span><span style="display:flex;"><span>    device_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/dev/sdd&#34;</span>
</span></span><span style="display:flex;"><span>    instance_id <span style="color:#f92672">=</span> aws_instance<span style="color:#f92672">.</span>web1<span style="color:#f92672">.</span>id
</span></span><span style="display:flex;"><span>    volume_id <span style="color:#f92672">=</span> aws_ebs_volume<span style="color:#f92672">.</span>awsvolume<span style="color:#f92672">.</span>id
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_security_group&#34;</span> <span style="color:#e6db74">&#34;morning-ssh-http&#34;</span> {
</span></span><span style="display:flex;"><span>  name        <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;morning-ssh-http&#34;</span>
</span></span><span style="display:flex;"><span>  description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;allow ssh and http traffic&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ingress {
</span></span><span style="display:flex;"><span>    from_port   <span style="color:#f92672">=</span> <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>    to_port     <span style="color:#f92672">=</span> <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>    protocol    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>    cidr_blocks <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ingress {
</span></span><span style="display:flex;"><span>    from_port   <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    to_port     <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    protocol    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>    cidr_blocks <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  egress {
</span></span><span style="display:flex;"><span>    from_port       <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    to_port         <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    protocol        <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;-1&#34;</span>
</span></span><span style="display:flex;"><span>    cidr_blocks     <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;good-morning&#34;</span> {
</span></span><span style="display:flex;"><span>  ami               <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-02e136e904f3da870&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type     <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>  availability_zone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-east-1a&#34;</span>
</span></span><span style="display:flex;"><span>  security_groups   <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;${aws_security_group.morning-ssh-http.name}&#34;</span>]
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  user_data <span style="color:#f92672">=</span> <span style="color:#f92672">&lt;&lt;-</span>EOF
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">#! /bin/bash</span>
</span></span><span style="display:flex;"><span>                sudo yum install httpd <span style="color:#f92672">-</span>y
</span></span><span style="display:flex;"><span>                sudo systemctl start httpd
</span></span><span style="display:flex;"><span>                sudo systemctl enable httpd
</span></span><span style="display:flex;"><span>                echo <span style="color:#e6db74">&#34;&lt;h1&gt;Sample Webserver Network Nuts&#34;</span> <span style="color:#f92672">|</span> sudo tee  <span style="color:#e6db74">/var/</span>www<span style="color:#e6db74">/html/i</span>ndex<span style="color:#f92672">.</span>html
</span></span><span style="display:flex;"><span>  EOF
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;webserver&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Create ec2 instance in two different regions.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web1&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-02e136e904f3da870&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>  availability_zone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-east-1a&#34;</span>
</span></span><span style="display:flex;"><span>  provider <span style="color:#f92672">=</span> alias<span style="color:#f92672">.</span>name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Use two different credentials with with same provider.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform {
</span></span><span style="display:flex;"><span>  required_providers {
</span></span><span style="display:flex;"><span>    aws <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      source <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hashicorp/aws&#34;</span>
</span></span><span style="display:flex;"><span>      version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;3.63.0&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>     google <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      source <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hashicorp/google&#34;</span>
</span></span><span style="display:flex;"><span>      version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;3.88.0&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>provider <span style="color:#e6db74">&#34;google&#34;</span> {
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>provider <span style="color:#e6db74">&#34;aws&#34;</span> {
</span></span><span style="display:flex;"><span>  region <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-east-1&#34;</span>
</span></span><span style="display:flex;"><span>  access_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AKIA4OE5FOTPLXF26KWA&#34;</span>
</span></span><span style="display:flex;"><span>  secret_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CHzpThwVfDt3xNCXmp5UPPnueFmGjIP5e3glxoRy&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>provider <span style="color:#e6db74">&#34;aws&#34;</span> {
</span></span><span style="display:flex;"><span>  region <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-west-1&#34;</span>
</span></span><span style="display:flex;"><span>  access_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AKIA4OE5FOTPF5MR4742&#34;</span>
</span></span><span style="display:flex;"><span>  secret_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;YsHwWvHNsM9rKG3BRe0l97euEy4CzuHpF41rQw4k&#34;</span>
</span></span><span style="display:flex;"><span>  alias <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;custom&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>update the configuration with random provider</li>
<li>update the configuration with null resources</li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="data-sources-examples" data-heading="Data Sources Examples" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="data-sources-examples">Data Sources Examples</h4><ul>
<li>Example1 fetch the ami info</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>data <span style="color:#e6db74">&#34;aws_ami&#34;</span> <span style="color:#e6db74">&#34;app_ami&#34;</span> {
</span></span><span style="display:flex;"><span>  most_recent <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>  owners <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;self&#34;</span>]
</span></span><span style="display:flex;"><span>  filter {
</span></span><span style="display:flex;"><span>    name   <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;name&#34;</span>
</span></span><span style="display:flex;"><span>    values <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;HelloWorld&#34;</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;app&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;${data.aws_ami.app_ami.id}&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Example1 fetch Instance info</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>data <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;myawsinstance&#34;</span> {
</span></span><span style="display:flex;"><span>    filter {
</span></span><span style="display:flex;"><span>      name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tag:Name&#34;</span>
</span></span><span style="display:flex;"><span>      values <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;Terraform EC2&#34;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    depends_on <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;aws_instance.ec2_example&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></div><ul>
<li>Example1 fetch the ami</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>data <span style="color:#e6db74">&#34;aws_ami&#34;</span> <span style="color:#e6db74">&#34;myAmi&#34;</span> {
</span></span><span style="display:flex;"><span> owners <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;099720109477&#34;</span>]
</span></span><span style="display:flex;"><span> most_recent <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> filter {
</span></span><span style="display:flex;"><span>   name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;description&#34;</span>
</span></span><span style="display:flex;"><span>   values <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;Canonical, Ubuntu, 20.04 LTS*&#34;</span>]
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> filter {
</span></span><span style="display:flex;"><span>   name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;architecture&#34;</span>
</span></span><span style="display:flex;"><span>   values <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;x86_64&#34;</span>]
</span></span><span style="display:flex;"><span> }
</span></span></code></pre></div><ul>
<li>Subnet</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>data <span style="color:#e6db74">&#34;aws_subnet&#34;</span> <span style="color:#e6db74">&#34;get-subnet-id&#34;</span> {
</span></span><span style="display:flex;"><span>  filter {
</span></span><span style="display:flex;"><span>    name   <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tag:Name&#34;</span>
</span></span><span style="display:flex;"><span>    values <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;public-1&#34;</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Print the subnet fetched from data source</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;aws_subnet_id&#34;</span> {
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>aws_subnet<span style="color:#f92672">.</span>get<span style="color:#f92672">-</span>subnet<span style="color:#f92672">-</span>id<span style="color:#f92672">.</span>id
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>variable <span style="color:#e6db74">&#34;vpc_id&#34;</span> {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data <span style="color:#e6db74">&#34;aws_vpc&#34;</span> <span style="color:#e6db74">&#34;selected&#34;</span> {
</span></span><span style="display:flex;"><span>  id <span style="color:#f92672">=</span> var<span style="color:#f92672">.</span>vpc_id
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_subnet&#34;</span> <span style="color:#e6db74">&#34;example&#34;</span> {
</span></span><span style="display:flex;"><span>  vpc_id            <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>aws_vpc<span style="color:#f92672">.</span>selected<span style="color:#f92672">.</span>id
</span></span><span style="display:flex;"><span>  availability_zone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-west-2a&#34;</span>
</span></span><span style="display:flex;"><span>  cidr_block        <span style="color:#f92672">=</span> cidrsubnet(data<span style="color:#f92672">.</span>aws_vpc<span style="color:#f92672">.</span>selected<span style="color:#f92672">.</span>cidr_block, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Data Source ec2 instance</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>provider <span style="color:#e6db74">&#34;aws&#34;</span> {
</span></span><span style="display:flex;"><span>    region     <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;eu-central-1&#34;</span>
</span></span><span style="display:flex;"><span>    access_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AKIATQ37NXB2JMXVGYPG&#34;</span>
</span></span><span style="display:flex;"><span>    secret_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ockvEN1DzYynDuKIh56BVQv/tMqmzvKnYB8FttSp&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;ec2_example&#34;</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0767046d1677be5a0&#34;</span>
</span></span><span style="display:flex;"><span>    instance_type <span style="color:#f92672">=</span>  <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Terraform EC2&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;myawsinstance&#34;</span> {
</span></span><span style="display:flex;"><span>    filter {
</span></span><span style="display:flex;"><span>        name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tag:Name&#34;</span>
</span></span><span style="display:flex;"><span>        values <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;Terraform EC2&#34;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    depends_on <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;aws_instance.ec2_example&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;fetched_info_from_aws&#34;</span> {
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>aws_instance<span style="color:#f92672">.</span>myawsinstance<span style="color:#f92672">.</span>public_ip
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="terraform-meta-arguments" data-heading="Terraform Meta Arguments" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="terraform-meta-arguments">Terraform Meta Arguments</h4><!-- end-chunk -->
<!-- begin-chunk data-anchor="depends_on" data-heading="Depends_on" data-level="5" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h5 id="depends_on">Depends_on</h5><ul>
<li>Depends_on Example 1</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_s3_bucket&#34;</span> <span style="color:#e6db74">&#34;example&#34;</span> {
</span></span><span style="display:flex;"><span>  acl    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;private&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;example_c&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>aws_ami<span style="color:#f92672">.</span>amazon_linux<span style="color:#f92672">.</span>id
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  depends_on <span style="color:#f92672">=</span> [aws_s3_bucket<span style="color:#f92672">.</span>example]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="lifecycle" data-heading="LifeCycle" data-level="5" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h5 id="lifecycle">LifeCycle</h5><ul>
<li>Example 1</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;example&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  lifecycle {
</span></span><span style="display:flex;"><span>    ignore_changes <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Ignore changes to tags, e.g. because a management agent</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># updates these based on some ruleset managed elsewhere.</span>
</span></span><span style="display:flex;"><span>      tags,
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Example 2</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;example&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  lifecycle {
</span></span><span style="display:flex;"><span>    create_before_destroy <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Example 3</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;azurerm_resource_group&#34;</span> <span style="color:#e6db74">&#34;example&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> lifecycle {
</span></span><span style="display:flex;"><span>   prevent_destroy <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="aws-instance-with-security-group-and-eip-association" data-heading="AWS instance with Security group and EIP association" data-level="6" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h6 id="aws-instance-with-security-group-and-eip-association">AWS instance with Security group and EIP association</h6><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>provider <span style="color:#e6db74">&#34;aws&#34;</span> {
</span></span><span style="display:flex;"><span>  region     <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-west-2&#34;</span>
</span></span><span style="display:flex;"><span>  access_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;PUT-YOUR-ACCESS-KEY-HERE&#34;</span>
</span></span><span style="display:flex;"><span>  secret_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;PUT-YOUR-SECRET-KEY-HERE&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;myec2&#34;</span> {
</span></span><span style="display:flex;"><span>   ami <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-082b5a644766e0e6f&#34;</span>
</span></span><span style="display:flex;"><span>   instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_eip&#34;</span> <span style="color:#e6db74">&#34;lb&#34;</span> {
</span></span><span style="display:flex;"><span>  vpc      <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_eip_association&#34;</span> <span style="color:#e6db74">&#34;eip_assoc&#34;</span> {
</span></span><span style="display:flex;"><span>  instance_id   <span style="color:#f92672">=</span> aws_instance<span style="color:#f92672">.</span>myec2<span style="color:#f92672">.</span>id
</span></span><span style="display:flex;"><span>  allocation_id <span style="color:#f92672">=</span> aws_eip<span style="color:#f92672">.</span>lb<span style="color:#f92672">.</span>id
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_security_group&#34;</span> <span style="color:#e6db74">&#34;allow_tls&#34;</span> {
</span></span><span style="display:flex;"><span>  name        <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;test-security-group&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ingress {
</span></span><span style="display:flex;"><span>    from_port   <span style="color:#f92672">=</span> <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>    to_port     <span style="color:#f92672">=</span> <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>    protocol    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>    cidr_blocks <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;${aws_eip.lb.public_ip}/32&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    cidr_blocks = [aws_eip.lb.public_ip/32]</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li><a href="https://graphviz.org/download/" target="_blank" rel="noopener">Click here to download and Install graphviz </a></li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="topics-to-be-covered" data-heading="Topics to be covered" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="topics-to-be-covered">Topics to be covered</h3><ul>
<li><input checked="" disabled="" type="checkbox"> Meta  Arguments</li>
<li><input checked="" disabled="" type="checkbox"> Variables</li>
<li><input checked="" disabled="" type="checkbox"> Locals</li>
<li><input checked="" disabled="" type="checkbox"> Dynamic Blocks</li>
<li><input checked="" disabled="" type="checkbox"> Functions</li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="variables" data-heading="Variables" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="variables">Variables</h4><ul>
<li>
<p><input checked="" disabled="" type="checkbox"> Parameterized variables</p>
</li>
<li>
<p>Parameters with default values</p>
</li>
<li>
<p>Terraform values from  tfvars files</p>
</li>
<li>
<p>Terraform variables from TF vars</p>
</li>
<li>
<p><input checked="" disabled="" type="checkbox"> Override variable value on runtime</p>
</li>
<li>
<p><input checked="" disabled="" type="checkbox"> Check variable value using output</p>
</li>
<li>
<p>Define Locals</p>
</li>
<li>
<p>Check local values using output</p>
</li>
<li>
<p>Define a Prompt Variable</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>variable <span style="color:#e6db74">&#34;variable_name&#34;</span> {}
</span></span></code></pre></div><ul>
<li>Value at apply</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform apply <span style="color:#f92672">-</span>var variable_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;value&#34;</span>
</span></span></code></pre></div><ul>
<li>Access Variables</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span> var<span style="color:#f92672">.</span><span style="color:#e6db74">&lt;varname&gt;</span>
</span></span></code></pre></div><ul>
<li>String(Data Type)  Variables</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>variable <span style="color:#e6db74">&#34;var1&#34;</span> {
</span></span><span style="display:flex;"><span>  type <span style="color:#f92672">=</span> string
</span></span><span style="display:flex;"><span>  default <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;01000000-0000-4000-8000-000030080200&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>List variable</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>variable <span style="color:#e6db74">&#34;users&#34;</span> {
</span></span><span style="display:flex;"><span>  type    <span style="color:#f92672">=</span> list
</span></span><span style="display:flex;"><span>  default <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;root&#34;</span>, <span style="color:#e6db74">&#34;user1&#34;</span>, <span style="color:#e6db74">&#34;user2&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Map variables</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>variable <span style="color:#e6db74">&#34;plans&#34;</span> {
</span></span><span style="display:flex;"><span>  type <span style="color:#f92672">=</span> map
</span></span><span style="display:flex;"><span>  default <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;5USD&#34;</span>  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1xCPU-1GB&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;10USD&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1xCPU-2GB&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;20USD&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2xCPU-4GB&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Access varible from map</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>plan <span style="color:#f92672">=</span> var<span style="color:#f92672">.</span>plans[<span style="color:#e6db74">&#34;5USD&#34;</span>]
</span></span></code></pre></div><ul>
<li>Map Example</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>variable <span style="color:#e6db74">&#34;storage_sizes&#34;</span> {
</span></span><span style="display:flex;"><span>  type <span style="color:#f92672">=</span> map
</span></span><span style="display:flex;"><span>  default <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;1xCPU-1GB&#34;</span>  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;25&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;1xCPU-2GB&#34;</span>  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;50&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;2xCPU-4GB&#34;</span>  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;80&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Use lookup (real example region and ami)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>size <span style="color:#f92672">=</span> lookup(var<span style="color:#f92672">.</span>storage_sizes, var<span style="color:#f92672">.</span>plans[<span style="color:#e6db74">&#34;5USD&#34;</span>])
</span></span></code></pre></div><ul>
<li>Boolean</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>variable <span style="color:#e6db74">&#34;set_password&#34;</span> {
</span></span><span style="display:flex;"><span> default <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Access Boolean Variables</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>create_password <span style="color:#f92672">=</span> var<span style="color:#f92672">.</span>set_password
</span></span></code></pre></div><ul>
<li>Pass the value at apply end</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform apply <span style="color:#f92672">-</span>var set_password<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;true&#34;</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="loading-variables-automatically" data-heading="Loading variables automatically" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="loading-variables-automatically">Loading variables automatically</h4><ul>
<li>
<p>Files named exactly terraform.tfvars or terraform.tfvars.json.</p>
</li>
<li>
<p>Any files with names ending in .auto.tfvars or .auto.tfvars.json.</p>
</li>
<li>
<p>Define variable into a files</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>vi terraform<span style="color:#f92672">.</span>tfvars
</span></span><span style="display:flex;"><span>set_password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>users <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;root&#34;</span>, <span style="color:#e6db74">&#34;admin&#34;</span>]
</span></span><span style="display:flex;"><span>plan <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;20USD&#34;</span>
</span></span><span style="display:flex;"><span>templates <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;ubuntu20&#34;</span>:<span style="color:#e6db74">&#34;01000000-0000-4000-8000-000030080200&#34;</span>, <span style="color:#e6db74">&#34;centos8&#34;</span>:<span style="color:#e6db74">&#34;01000000-0000-4000-8000-000050010300&#34;</span>}
</span></span><span style="display:flex;"><span>template <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ubuntu20&#34;</span>
</span></span></code></pre></div><ul>
<li>Json way</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;set_password&#34;</span>: <span style="color:#e6db74">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;users&#34;</span>: [<span style="color:#e6db74">&#34;root&#34;</span>, <span style="color:#e6db74">&#34;admin&#34;</span>],
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;plan&#34;</span>: <span style="color:#e6db74">&#34;20USD&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;templates&#34;</span>: {<span style="color:#e6db74">&#34;ubuntu20&#34;</span>:<span style="color:#e6db74">&#34;01000000-0000-4000-8000-000030200200&#34;</span>, <span style="color:#e6db74">&#34;centos8&#34;</span>:<span style="color:#e6db74">&#34;01000000-0000-4000-8000-000050010400&#34;</span>},
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;template&#34;</span>: <span style="color:#e6db74">&#34;ubuntu20&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Using tfvar file other than terrafom.tfvars</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform apply <span style="color:#f92672">-</span>var<span style="color:#f92672">-</span>file<span style="color:#f92672">=</span>dev<span style="color:#f92672">.</span>tfvars
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="how-to-use-terraform-resource-meta-arguments" data-heading="How to use Terraform resource meta arguments?" data-level="5" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h5 id="how-to-use-terraform-resource-meta-arguments">How to use Terraform resource meta arguments?</h5><ul>
<li>
<p>You can create multiple aws_resource using the count</p>
</li>
<li>
<p>for_each can be used for iteration and can also help you to create multiple aws_resource using the same block</p>
</li>
<li>
<p>provider is used for overriding terraform default behavior using the alias</p>
</li>
<li>
<p>With lifecycle you can prevent destroy, create resource after destroy and ignore changes to be saved inside tstate</p>
</li>
<li>
<p>count</p>
</li>
<li>
<p>for_each</p>
</li>
<li>
<p>provider</p>
</li>
<li>
<p>lifecycle</p>
</li>
<li>
<p>Count Example</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;ec2_example&#34;</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   count         <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> 
</span></span><span style="display:flex;"><span>   ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0767046d1677be5a0&#34;</span>
</span></span><span style="display:flex;"><span>   instance_type <span style="color:#f92672">=</span>  <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>           Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Terraform EC2&#34;</span>
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>For each example</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;ec2_example&#34;</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    for_each <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      instance1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>      instance2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span> 
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0767046d1677be5a0&#34;</span>
</span></span><span style="display:flex;"><span>   instance_type <span style="color:#f92672">=</span>  each<span style="color:#f92672">.</span>value
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>           Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Terraform ${each.key}&#34;</span>
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></div><ul>
<li>lifecycle</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;ec2_example&#34;</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   count         <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> 
</span></span><span style="display:flex;"><span>   ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0767046d1677be5a0&#34;</span>
</span></span><span style="display:flex;"><span>   instance_type <span style="color:#f92672">=</span>  <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>           Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Terraform EC2&#34;</span>
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>       lifecycle {
</span></span><span style="display:flex;"><span>      create_before_destroy <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#prevent_destroy       = true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#ignore_changes        = [tags]</span>
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="table-of-content" data-heading="Table of Content" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="table-of-content">Table of Content</h3><ul>
<li>
<p>Loops with count</p>
</li>
<li>
<p>Loops with for_each</p>
</li>
<li>
<p>for loop</p>
</li>
<li>
<p>List Variable</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>variable <span style="color:#e6db74">&#34;user_names&#34;</span> {
</span></span><span style="display:flex;"><span>  description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;IAM usernames&#34;</span>
</span></span><span style="display:flex;"><span>  type        <span style="color:#f92672">=</span> list(string)
</span></span><span style="display:flex;"><span>  default     <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;user1&#34;</span>, <span style="color:#e6db74">&#34;user2&#34;</span>, <span style="color:#e6db74">&#34;user3&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Count</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_iam_user&#34;</span> <span style="color:#e6db74">&#34;example&#34;</span> {
</span></span><span style="display:flex;"><span>  count <span style="color:#f92672">=</span> length(var<span style="color:#f92672">.</span>user_names)
</span></span><span style="display:flex;"><span>  name  <span style="color:#f92672">=</span> var<span style="color:#f92672">.</span>user_names[count<span style="color:#f92672">.</span>index]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p>Loops with for_each</p>
</li>
<li>
<p>Note : - It can only be used on set(string) or map(string).</p>
</li>
<li>
<p>The reason why for_each does not work on list(string) is because a list can contain duplicate values but if you are using set(string) or map(string) then it does not support duplicate values.</p>
</li>
<li>
<p>Define variable</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>variable <span style="color:#e6db74">&#34;user_names&#34;</span> {
</span></span><span style="display:flex;"><span>  description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;IAM usernames&#34;</span>
</span></span><span style="display:flex;"><span>  type        <span style="color:#f92672">=</span> set(string)
</span></span><span style="display:flex;"><span>  default     <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;user1&#34;</span>, <span style="color:#e6db74">&#34;user2&#34;</span>, <span style="color:#e6db74">&#34;user3s&#34;</span>]
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></div><ul>
<li>Use for each now</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_iam_user&#34;</span> <span style="color:#e6db74">&#34;example&#34;</span> {
</span></span><span style="display:flex;"><span>  for_each <span style="color:#f92672">=</span> var<span style="color:#f92672">.</span>user_names
</span></span><span style="display:flex;"><span>  name  <span style="color:#f92672">=</span> each<span style="color:#f92672">.</span>value
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>for loop</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>variable <span style="color:#e6db74">&#34;user_names&#34;</span> {
</span></span><span style="display:flex;"><span>  description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;IAM usernames&#34;</span>
</span></span><span style="display:flex;"><span>  type        <span style="color:#f92672">=</span> list(string)
</span></span><span style="display:flex;"><span>  default     <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;user1&#34;</span>, <span style="color:#e6db74">&#34;user2&#34;</span>, <span style="color:#e6db74">&#34;user3&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Test</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;print_the_names&#34;</span> {
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> [<span style="color:#66d9ef">for</span> name in var<span style="color:#f92672">.</span>user_names : name]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>For loop with map</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>variable <span style="color:#e6db74">&#34;iam_users&#34;</span> {
</span></span><span style="display:flex;"><span>  description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;map&#34;</span>
</span></span><span style="display:flex;"><span>  type        <span style="color:#f92672">=</span> map(string)
</span></span><span style="display:flex;"><span>  default     <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    user1      <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;normal user&#34;</span>
</span></span><span style="display:flex;"><span>    user2  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;admin user&#34;</span>
</span></span><span style="display:flex;"><span>    user3 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;root user&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Perform a test</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;user_with_roles&#34;</span> {
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> [<span style="color:#66d9ef">for</span> name, role in var<span style="color:#f92672">.</span>iam_users : <span style="color:#e6db74">&#34;${name} is the ${role}&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="how-to-use-terraform-locals" data-heading="How to use Terraform locals?" data-level="5" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h5 id="how-to-use-terraform-locals">How to use Terraform locals?</h5><ul>
<li>Define Local</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>locals {
</span></span><span style="display:flex;"><span>  staging_env <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;staging&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Use local variable</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;ec2_example&#34;</span> {
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>   ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0767046d1677be5a0&#34;</span>
</span></span><span style="display:flex;"><span>   instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>   subnet_id <span style="color:#f92672">=</span> aws_subnet<span style="color:#f92672">.</span>staging<span style="color:#f92672">-</span>subnet<span style="color:#f92672">.</span>id
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>   tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>           Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;${local.staging_env} - Terraform EC2&#34;</span>
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Local can also use variable</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>locals {
</span></span><span style="display:flex;"><span>    server_details <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;${var.location}-${var.server_name}&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="conditions" data-heading="Conditions" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="conditions">Conditions</h3><ul>
<li>Use below condition based on env</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>variable env {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tfvars
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>env <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;prod&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>main<span style="color:#f92672">.</span>tf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>count <span style="color:#f92672">=</span> var<span style="color:#f92672">.</span>env <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;prod&#34;</span> ? <span style="color:#ae81ff">5</span> : <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><ul>
<li>How to download the plugin for provider</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform init
</span></span></code></pre></div><ul>
<li>How to create a infra</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform apply 
</span></span></code></pre></div><ul>
<li>How to delete all resources created by Terraform</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform destroy
</span></span></code></pre></div><ul>
<li>How to destroy one specific resource which is created with terraform</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform destroy <span style="color:#f92672">-</span>target<span style="color:#f92672">=</span>resource_type<span style="color:#f92672">.</span>resource_name
</span></span></code></pre></div><ul>
<li>check state file</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform show
</span></span></code></pre></div><ul>
<li>Terraform state related commands</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>Subcommands:
</span></span><span style="display:flex;"><span>    list                List resources in the state
</span></span><span style="display:flex;"><span>    mv                  Move an item in the state
</span></span><span style="display:flex;"><span>    pull                Pull current state <span style="color:#f92672">and</span> output to stdout
</span></span><span style="display:flex;"><span>    push                Update remote state from a local state file
</span></span><span style="display:flex;"><span>    replace<span style="color:#f92672">-</span>provider    Replace provider in the state
</span></span><span style="display:flex;"><span>    rm                  Remove instances from the state
</span></span><span style="display:flex;"><span>    show                Show a resource in the state
</span></span></code></pre></div><ul>
<li>list  Resources in state file</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform state list
</span></span></code></pre></div><ul>
<li>Filtering by Resource</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform state list aws_instance<span style="color:#f92672">.</span>bar
</span></span></code></pre></div><ul>
<li>Remove from state file</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform state rm aws_instance<span style="color:#f92672">.</span>web
</span></span></code></pre></div><ul>
<li>check specific resource in state file</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform state show <span style="color:#e6db74">&#39;aws_vpc.my_vpc&#39;</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="terraform-output" data-heading="Terraform Output:" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="terraform-output">Terraform Output:</h3><blockquote>
<p>The terraform output command is used to extract the value of an output variable from the state file.
** Examples**</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;instance_ips&#34;</span> {
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> aws_instance<span style="color:#f92672">.</span>web<span style="color:#f92672">.*.</span>public_ip
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;lb_address&#34;</span> {
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> aws_alb<span style="color:#f92672">.</span>web<span style="color:#f92672">.</span>public_dns
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;password&#34;</span> {
</span></span><span style="display:flex;"><span>  sensitive <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> var<span style="color:#f92672">.</span>secret_password
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>to list output</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span> terraform output
</span></span><span style="display:flex;"><span>instance_ips <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;54.43.114.12&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;52.122.13.4&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;52.4.116.53&#34;</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>lb_address <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;my-app-alb-1657023003.us-east-1.elb.amazonaws.com&#34;</span>
</span></span><span style="display:flex;"><span>password <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;sensitive&gt;</span>
</span></span></code></pre></div><ul>
<li>Rename a resource in state file</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform state mv packet_device<span style="color:#f92672">.</span>worker packet_device<span style="color:#f92672">.</span>helper
</span></span></code></pre></div><ul>
<li>Pull state file</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform state pull
</span></span></code></pre></div><ul>
<li>Remove some resource from state file</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform state rm <span style="color:#e6db74">&#39;module.foo.packet_device.worker&#39;</span>
</span></span></code></pre></div><ul>
<li>How to define remote state file</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform {
</span></span><span style="display:flex;"><span>  backend <span style="color:#e6db74">&#34;s3&#34;</span> {
</span></span><span style="display:flex;"><span>    bucket <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;terraform121&#34;</span>
</span></span><span style="display:flex;"><span>    region <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-west-2&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="terraform-workspace" data-heading="Terraform Workspace" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="terraform-workspace">Terraform Workspace</h3><p>Terraform maintains separate file for each environment</p>
<ul>
<li>Check terraform workspace</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span> terraform workspace list
</span></span></code></pre></div><ul>
<li>Create a new workspace</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform workspace <span style="color:#66d9ef">new</span> dev
</span></span></code></pre></div><ul>
<li>see current workspace</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform workspace show
</span></span></code></pre></div><ul>
<li>Reconfigure state file</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>terraform init <span style="color:#e6db74">&#34;-reconfigure&#34;</span>
</span></span></code></pre></div><ul>
<li>Switch to each workspace and check state resource</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    terraform workspace select default
</span></span><span style="display:flex;"><span>    terraform state list
</span></span><span style="display:flex;"><span>    terraform workspace select dev
</span></span><span style="display:flex;"><span>    terraform state list
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="terraform-provisioner" data-heading="Terraform Provisioner" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="terraform-provisioner">Terraform Provisioner</h3><!-- end-chunk -->
<!-- begin-chunk data-anchor="local-exec" data-heading="Local Exec" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="local-exec">Local Exec</h4><ul>
<li>
<p>Does not require any connection</p>
</li>
<li>
<p>Example for local-exec</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0c2d06d50ce30b442&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  provisioner <span style="color:#e6db74">&#34;local-exec&#34;</span> {
</span></span><span style="display:flex;"><span>    command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;echo The server&#39;s IP address is ${self.private_ip}&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Example 2</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0c2d06d50ce30b442&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  provisioner <span style="color:#e6db74">&#34;local-exec&#34;</span> {
</span></span><span style="display:flex;"><span>    command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;echo ${aws_instance.web.public_ip} &gt;&gt;/tmp/ip.txt&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Creating a file when destroy</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0c2d06d50ce30b442&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  provisioner <span style="color:#e6db74">&#34;local-exec&#34;</span> {
</span></span><span style="display:flex;"><span>    when <span style="color:#f92672">=</span> destroy
</span></span><span style="display:flex;"><span>    command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;echo ${self.public_ip} destroy!  &gt;/tmp/ip.txt&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>On failure  fail</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0c2d06d50ce30b442&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  provisioner <span style="color:#e6db74">&#34;local-exec&#34;</span> {
</span></span><span style="display:flex;"><span>    on_failure <span style="color:#f92672">=</span> fail
</span></span><span style="display:flex;"><span>    command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;echo ${self.public_ip} destroy!  &gt;/tmp/ip.txt&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>On failure continue</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0c2d06d50ce30b442&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  provisioner <span style="color:#e6db74">&#34;local-exec&#34;</span> {
</span></span><span style="display:flex;"><span>    on_failure <span style="color:#f92672">=</span> <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;echo ${self.public_ip} destroy!  &gt;/tmp/ip.txt&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="terraform-provisioner-1" data-heading="Terraform Provisioner" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="terraform-provisioner-1">Terraform Provisioner</h3><!-- end-chunk -->
<!-- begin-chunk data-anchor="remote-exec" data-heading="Remote Exec" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="remote-exec">Remote Exec</h4><ul>
<li>Requires Conection block</li>
<li>Example 1</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0c2d06d50ce30b442&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>  key_name  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mykey&#34;</span>
</span></span><span style="display:flex;"><span>  vpc_security_group_ids <span style="color:#f92672">=</span> [aws_security_group<span style="color:#f92672">.</span>main<span style="color:#f92672">.</span>id]
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Terraform&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span> provisioner <span style="color:#e6db74">&#34;remote-exec&#34;</span> {
</span></span><span style="display:flex;"><span>  inline <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;echo $(hostname -i) &gt;&gt; /tmp/new.txt&#34;</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span> connection {
</span></span><span style="display:flex;"><span>  type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ssh&#34;</span>
</span></span><span style="display:flex;"><span>  host <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>public_ip
</span></span><span style="display:flex;"><span>  user  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ec2-user&#34;</span>
</span></span><span style="display:flex;"><span>  private_key <span style="color:#f92672">=</span> file(<span style="color:#e6db74">&#34;/home/ec2-user/mykey.pem&#34;</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_security_group&#34;</span> <span style="color:#e6db74">&#34;main&#34;</span> {
</span></span><span style="display:flex;"><span>  egress <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      cidr_blocks      <span style="color:#f92672">=</span> [ <span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>, ]
</span></span><span style="display:flex;"><span>      description      <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      from_port        <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>      ipv6_cidr_blocks <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>      prefix_list_ids  <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>      protocol         <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;-1&#34;</span>
</span></span><span style="display:flex;"><span>      security_groups  <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>      self             <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>      to_port          <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>  ingress <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>     cidr_blocks      <span style="color:#f92672">=</span> [ <span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>, ]
</span></span><span style="display:flex;"><span>     description      <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>     from_port        <span style="color:#f92672">=</span> <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>     ipv6_cidr_blocks <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>     prefix_list_ids  <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>     protocol         <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>     security_groups  <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>     self             <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>     to_port          <span style="color:#f92672">=</span> <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Terraform Logs</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>export TF_LOG_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">/tmp/</span>terraform<span style="color:#f92672">.</span>log
</span></span></code></pre></div><ul>
<li>Test the file created</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span> ssh <span style="color:#f92672">-</span>i <span style="color:#e6db74">/home/</span>ec2<span style="color:#f92672">-</span>user<span style="color:#f92672">/</span>mykey<span style="color:#f92672">.</span>pem ec2<span style="color:#f92672">-</span>user@34<span style="color:#ae81ff">.220.203.9</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="-dynamic-blocks" data-heading="##### Dynamic Blocks" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="-dynamic-blocks">##### Dynamic Blocks</h3><ul>
<li>Without Dynamic Blocks</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_security_group&#34;</span> <span style="color:#e6db74">&#34;main&#34;</span> {
</span></span><span style="display:flex;"><span>   name   <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;resource_without_dynamic_block&#34;</span>
</span></span><span style="display:flex;"><span>   vpc_id <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>aws_vpc<span style="color:#f92672">.</span>main<span style="color:#f92672">.</span>id
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   ingress {
</span></span><span style="display:flex;"><span>      description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ingress_rule_1&#34;</span>
</span></span><span style="display:flex;"><span>      from_port   <span style="color:#f92672">=</span> <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>      to_port     <span style="color:#f92672">=</span> <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>      protocol    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>      cidr_blocks <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>]
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>   ingress {
</span></span><span style="display:flex;"><span>      description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ingress_rule_2&#34;</span>
</span></span><span style="display:flex;"><span>      from_port   <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>      to_port     <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>      protocol    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>      cidr_blocks <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>]
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AWS security group non-dynamic block&#34;</span>
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>With Local values</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>locals {
</span></span><span style="display:flex;"><span>   ingress_rules <span style="color:#f92672">=</span> [{
</span></span><span style="display:flex;"><span>      port        <span style="color:#f92672">=</span> <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>      description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Ingress rules for port 443&#34;</span>
</span></span><span style="display:flex;"><span>   },
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>      port        <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>      description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Ingree rules for port 80&#34;</span>
</span></span><span style="display:flex;"><span>   }]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_security_group&#34;</span> <span style="color:#e6db74">&#34;main&#34;</span> {
</span></span><span style="display:flex;"><span>   name   <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;resource_with_dynamic_block&#34;</span>
</span></span><span style="display:flex;"><span>   vpc_id <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>aws_vpc<span style="color:#f92672">.</span>main<span style="color:#f92672">.</span>id
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   dynamic <span style="color:#e6db74">&#34;ingress&#34;</span> {
</span></span><span style="display:flex;"><span>      for_each <span style="color:#f92672">=</span> local<span style="color:#f92672">.</span>ingress_rules
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      content {
</span></span><span style="display:flex;"><span>         description <span style="color:#f92672">=</span> ingress<span style="color:#f92672">.</span>value<span style="color:#f92672">.</span>description
</span></span><span style="display:flex;"><span>         from_port   <span style="color:#f92672">=</span> ingress<span style="color:#f92672">.</span>value<span style="color:#f92672">.</span>port
</span></span><span style="display:flex;"><span>         to_port     <span style="color:#f92672">=</span> ingress<span style="color:#f92672">.</span>value<span style="color:#f92672">.</span>port
</span></span><span style="display:flex;"><span>         protocol    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>         cidr_blocks <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AWS security group dynamic block&#34;</span>
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="testing-with-null-resoures" data-heading="Testing with null resoures" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="testing-with-null-resoures">Testing with null resoures</h4><ul>
<li>Example 1 count</li>
</ul>
<pre tabindex="0"><code>resource &#34;null_resource&#34; &#34;simple&#34; {
  count = 2
}
output &#34;simple&#34; {
  value = null_resource.simple
}
</code></pre><ul>
<li>Example List</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>locals {
</span></span><span style="display:flex;"><span>  names <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;bob&#34;</span>, <span style="color:#e6db74">&#34;kevin&#34;</span>, <span style="color:#e6db74">&#34;stewart&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;null_resource&#34;</span> <span style="color:#e6db74">&#34;names&#34;</span> {
</span></span><span style="display:flex;"><span>  count <span style="color:#f92672">=</span> length(local<span style="color:#f92672">.</span>names)
</span></span><span style="display:flex;"><span>  triggers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> local<span style="color:#f92672">.</span>names[count<span style="color:#f92672">.</span>index]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;names&#34;</span> {
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> null_resource<span style="color:#f92672">.</span>names
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>For Each: Simple List Example</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>locals {
</span></span><span style="display:flex;"><span> minions <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;bob&#34;</span>, <span style="color:#e6db74">&#34;kevin&#34;</span>, <span style="color:#e6db74">&#34;stewart&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;null_resource&#34;</span> <span style="color:#e6db74">&#34;minions&#34;</span> {
</span></span><span style="display:flex;"><span> for_each <span style="color:#f92672">=</span> toset(local<span style="color:#f92672">.</span>minions)
</span></span><span style="display:flex;"><span> triggers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>   name <span style="color:#f92672">=</span> each<span style="color:#f92672">.</span>value
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;minions&#34;</span> {
</span></span><span style="display:flex;"><span> value <span style="color:#f92672">=</span> null_resource<span style="color:#f92672">.</span>minions
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>For each map</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>locals {
</span></span><span style="display:flex;"><span>  heights <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    bob     <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;short&#34;</span>
</span></span><span style="display:flex;"><span>    kevin   <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tall&#34;</span>
</span></span><span style="display:flex;"><span>    stewart <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;medium&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;null_resource&#34;</span> <span style="color:#e6db74">&#34;heights&#34;</span> {
</span></span><span style="display:flex;"><span>  for_each <span style="color:#f92672">=</span> local<span style="color:#f92672">.</span>heights
</span></span><span style="display:flex;"><span>  triggers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    name   <span style="color:#f92672">=</span> each<span style="color:#f92672">.</span>key
</span></span><span style="display:flex;"><span>    height <span style="color:#f92672">=</span> each<span style="color:#f92672">.</span>value
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;heights&#34;</span> {
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> null_resource<span style="color:#f92672">.</span>heights
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Another Example</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>locals {
</span></span><span style="display:flex;"><span>  heights <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    bob     <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;short&#34;</span>
</span></span><span style="display:flex;"><span>    stewart <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;medium&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;null_resource&#34;</span> <span style="color:#e6db74">&#34;heights&#34;</span> {
</span></span><span style="display:flex;"><span>  for_each <span style="color:#f92672">=</span> local<span style="color:#f92672">.</span>heights
</span></span><span style="display:flex;"><span>  triggers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    name   <span style="color:#f92672">=</span> each<span style="color:#f92672">.</span>key
</span></span><span style="display:flex;"><span>    height <span style="color:#f92672">=</span> each<span style="color:#f92672">.</span>value
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;heights&#34;</span> {
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> null_resource<span style="color:#f92672">.</span>heights
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="conditions-1" data-heading="Conditions" data-level="5" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h5 id="conditions-1">Conditions</h5><ul>
<li>[  ] Example 1</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;a1&#34;</span> {
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> true ? <span style="color:#e6db74">&#34;is true&#34;</span> : <span style="color:#e6db74">&#34;is false&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;a2&#34;</span> {
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> false ? <span style="color:#e6db74">&#34;is true&#34;</span> : <span style="color:#e6db74">&#34;is false&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;a3&#34;</span> {
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span> ? <span style="color:#e6db74">&#34;is true&#34;</span> : <span style="color:#e6db74">&#34;is false&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="transformation" data-heading="Transformation" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="transformation">Transformation</h4><ul>
<li>Example 1</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>locals {
</span></span><span style="display:flex;"><span>  list <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;a&#34;</span>,<span style="color:#e6db74">&#34;b&#34;</span>,<span style="color:#e6db74">&#34;c&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;list&#34;</span> {
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> [<span style="color:#66d9ef">for</span> s in local<span style="color:#f92672">.</span>list : upper(s)]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Map List</li>
</ul>
<pre tabindex="0"><code>locals {
  list = {a = 1, b = 2, c = 3}
}
output &#34;result1&#34; {
  value = [for k,v in local.list : &#34;${k}-${v}&#34; ]
}
output &#34;result2&#34; {
  value = [for k in local.list : k ]
}
</code></pre><p>Terraform Provisioner
Terraform State file
Terraform Lock
Terraform Cloud
Terraform Gitlab CICD
EKS with eksctl
Connect with EKS and deploy application
EKS with Terraform</p>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="local-exec-1" data-heading="Local Exec" data-level="5" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h5 id="local-exec-1">Local Exec</h5><ul>
<li>
<p>Does not reqire any connection</p>
</li>
<li>
<p>Example for local-exec</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0c2d06d50ce30b442&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  provisioner <span style="color:#e6db74">&#34;local-exec&#34;</span> {
</span></span><span style="display:flex;"><span>    command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;echo The server&#39;s IP address is ${self.private_ip}&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Example 2</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0c2d06d50ce30b442&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  provisioner <span style="color:#e6db74">&#34;local-exec&#34;</span> {
</span></span><span style="display:flex;"><span>    command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;echo ${aws_instance.web.public_ip} &gt;&gt;/tmp/ip.txt&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Creating a file when destroy</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0c2d06d50ce30b442&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  provisioner <span style="color:#e6db74">&#34;local-exec&#34;</span> {
</span></span><span style="display:flex;"><span>    when <span style="color:#f92672">=</span> destroy
</span></span><span style="display:flex;"><span>    command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;echo ${self.public_ip} destroy!  &gt;/tmp/ip.txt&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>On failure  fail</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0c2d06d50ce30b442&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  provisioner <span style="color:#e6db74">&#34;local-exec&#34;</span> {
</span></span><span style="display:flex;"><span>    on_failure <span style="color:#f92672">=</span> fail
</span></span><span style="display:flex;"><span>    command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;echo ${self.public_ip} destroy!  &gt;/tmp/ip.txt&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>On failure continue</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0c2d06d50ce30b442&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  provisioner <span style="color:#e6db74">&#34;local-exec&#34;</span> {
</span></span><span style="display:flex;"><span>    on_failure <span style="color:#f92672">=</span> <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;echo ${self.public_ip} destroy!  &gt;/tmp/ip.txt&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="terraform-provisioner-2" data-heading="Terraform Provisioner" data-level="3" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h3 id="terraform-provisioner-2">Terraform Provisioner</h3><!-- end-chunk -->
<!-- begin-chunk data-anchor="remote-exec-1" data-heading="Remote Exec" data-level="4" data-permalink="/docs/terraform/terraform-with-aws/" data-title="Terraform with AWS" -->
<h4 id="remote-exec-1">Remote Exec</h4><ul>
<li>Requires Conection block</li>
<li>Example 1</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-0c2d06d50ce30b442&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>  key_name  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mykey&#34;</span>
</span></span><span style="display:flex;"><span>  vpc_security_group_ids <span style="color:#f92672">=</span> [aws_security_group<span style="color:#f92672">.</span>main<span style="color:#f92672">.</span>id]
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Terraform&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span> provisioner <span style="color:#e6db74">&#34;remote-exec&#34;</span> {
</span></span><span style="display:flex;"><span>  inline <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;echo $(hostname -i) &gt;&gt; /tmp/new.txt&#34;</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span> connection {
</span></span><span style="display:flex;"><span>  type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ssh&#34;</span>
</span></span><span style="display:flex;"><span>  host <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>public_ip
</span></span><span style="display:flex;"><span>  user  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ec2-user&#34;</span>
</span></span><span style="display:flex;"><span>  private_key <span style="color:#f92672">=</span> file(<span style="color:#e6db74">&#34;/home/ec2-user/mykey.pem&#34;</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_security_group&#34;</span> <span style="color:#e6db74">&#34;main&#34;</span> {
</span></span><span style="display:flex;"><span>  egress <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      cidr_blocks      <span style="color:#f92672">=</span> [ <span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>, ]
</span></span><span style="display:flex;"><span>      description      <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      from_port        <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>      ipv6_cidr_blocks <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>      prefix_list_ids  <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>      protocol         <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;-1&#34;</span>
</span></span><span style="display:flex;"><span>      security_groups  <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>      self             <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>      to_port          <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>  ingress <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>     cidr_blocks      <span style="color:#f92672">=</span> [ <span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>, ]
</span></span><span style="display:flex;"><span>     description      <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>     from_port        <span style="color:#f92672">=</span> <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>     ipv6_cidr_blocks <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>     prefix_list_ids  <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>     protocol         <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>     security_groups  <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>     self             <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>     to_port          <span style="color:#f92672">=</span> <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Terraform Logs</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>export TF_LOG_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">/tmp/</span>terraform<span style="color:#f92672">.</span>log
</span></span></code></pre></div><ul>
<li>Test the file created</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span> ssh <span style="color:#f92672">-</span>i <span style="color:#e6db74">/home/</span>ec2<span style="color:#f92672">-</span>user<span style="color:#f92672">/</span>mykey<span style="color:#f92672">.</span>pem ec2<span style="color:#f92672">-</span>user@34<span style="color:#ae81ff">.220.203.9</span>
</span></span></code></pre></div><ul>
<li>File Provisoner Example</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  ami           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-02e136e904f3da870&#34;</span>
</span></span><span style="display:flex;"><span>  instance_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span>  key_name  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;news&#34;</span>
</span></span><span style="display:flex;"><span>  vpc_security_group_ids <span style="color:#f92672">=</span> [aws_security_group<span style="color:#f92672">.</span>main<span style="color:#f92672">.</span>id]
</span></span><span style="display:flex;"><span>  tags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    Name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Terraform&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span> provisioner <span style="color:#e6db74">&#34;file&#34;</span> {
</span></span><span style="display:flex;"><span>   source <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;n/tree.txt&#34;</span>
</span></span><span style="display:flex;"><span>   destination <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/tmp/rajveer/&#34;</span>
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span> connection {
</span></span><span style="display:flex;"><span>  type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ssh&#34;</span>
</span></span><span style="display:flex;"><span>  host <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>public_ip
</span></span><span style="display:flex;"><span>  user  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ec2-user&#34;</span>
</span></span><span style="display:flex;"><span>  private_key <span style="color:#f92672">=</span> file(<span style="color:#e6db74">&#34;${path.module}/news.pem&#34;</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>resource <span style="color:#e6db74">&#34;aws_security_group&#34;</span> <span style="color:#e6db74">&#34;main&#34;</span> {
</span></span><span style="display:flex;"><span>  egress <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      cidr_blocks      <span style="color:#f92672">=</span> [ <span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>, ]
</span></span><span style="display:flex;"><span>      description      <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      from_port        <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>      ipv6_cidr_blocks <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>      prefix_list_ids  <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>      protocol         <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;-1&#34;</span>
</span></span><span style="display:flex;"><span>      security_groups  <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>      self             <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>      to_port          <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>  ingress <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>     cidr_blocks      <span style="color:#f92672">=</span> [ <span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>, ]
</span></span><span style="display:flex;"><span>     description      <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>     from_port        <span style="color:#f92672">=</span> <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>     ipv6_cidr_blocks <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>     prefix_list_ids  <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>     protocol         <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>     security_groups  <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>     self             <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>     to_port          <span style="color:#f92672">=</span> <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output <span style="color:#e6db74">&#34;web&#34;</span> {
</span></span><span style="display:flex;"><span>  value <span style="color:#f92672">=</span> aws_instance<span style="color:#f92672">.</span>web<span style="color:#f92672">.</span>public_ip
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p><a href="https://www.terraform.io/docs/language/resources/provisioners/syntax.html" target="_blank" rel="noopener">Click Here to know more about failure </a></p>
</li>
<li>
<p><a href="https://www.hashicorp.com/products/terraform/pricing" target="_blank" rel="noopener"> Click Here for Terraform Cloud-pricing </a></p>
</li>
</ul>

        <div class="section-index">
    
    
    
    
    
    
    
    
    
</div>

	
	
	
</div>

          </main>
        </div>
      </div>
      
    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>




















<script src="/js/main.min.223ab2fcc7d742c1b94772c0276851c497da4343cd2d21534199ced90681e207.js" integrity="sha256-Ijqy/MfXQsG5R3LAJ2hRxJfaQ0PNLSFTQZnO2QaB4gc=" crossorigin="anonymous"></script>



<script src='/js/prism.js'></script>



  </body>
</html>