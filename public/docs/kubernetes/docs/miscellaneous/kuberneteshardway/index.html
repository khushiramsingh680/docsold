
<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.122.0">
<meta name="robots" content="index, follow">

<link rel="shortcut icon" href="/favicons/favicon.ico" >

<title>Kubernets Installation From Scatch on rocky 9 | Documentation</title>
<meta name="description" content="

Topics
Downloading Release Binaries
Configuring CA
Installing ETCD
Configuring API Server
Configuring Controller Manager
Configuring Scheduler …&lt;/!--&gt;&lt;/!--&gt;">
<meta property="og:title" content="Kubernets Installation From Scatch on rocky 9" />
<meta property="og:description" content="Topics Downloading Release Binaries Configuring CA Installing ETCD Configuring API Server Configuring Controller Manager Configuring Scheduler Validating Cluster Status Worker Node Configuration Configuring Networking API to Kubelet RBAC Configuring DNS Kubelet Preferred Instance Type Downloading Release Binaries Kubernetes Binaries Source Code Client Binaries Server Binaries Node Binaries Container Images Download release Binaries Download Etcd Install wget and unzip yum install wget unzip -y Download Server Binaries on master nodemkdir /root/binaries cd /root/binaries wget https://dl." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2024-06-01T18:32:23+05:30" />

<meta itemprop="name" content="Kubernets Installation From Scatch on rocky 9">
<meta itemprop="description" content="Topics Downloading Release Binaries Configuring CA Installing ETCD Configuring API Server Configuring Controller Manager Configuring Scheduler Validating Cluster Status Worker Node Configuration Configuring Networking API to Kubelet RBAC Configuring DNS Kubelet Preferred Instance Type Downloading Release Binaries Kubernetes Binaries Source Code Client Binaries Server Binaries Node Binaries Container Images Download release Binaries Download Etcd Install wget and unzip yum install wget unzip -y Download Server Binaries on master nodemkdir /root/binaries cd /root/binaries wget https://dl.">
<meta itemprop="dateModified" content="2024-06-01T18:32:23+05:30" />
<meta itemprop="wordCount" content="1782">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Kubernets Installation From Scatch on rocky 9"/>
<meta name="twitter:description" content="Topics Downloading Release Binaries Configuring CA Installing ETCD Configuring API Server Configuring Controller Manager Configuring Scheduler Validating Cluster Status Worker Node Configuration Configuring Networking API to Kubelet RBAC Configuring DNS Kubelet Preferred Instance Type Downloading Release Binaries Kubernetes Binaries Source Code Client Binaries Server Binaries Node Binaries Container Images Download release Binaries Download Etcd Install wget and unzip yum install wget unzip -y Download Server Binaries on master nodemkdir /root/binaries cd /root/binaries wget https://dl."/>




<link rel="preload" href="/scss/main.min.723d31f72c8542b0efd4dc916a8b429bb3241885d5c0984bf341c1aad66aed50.css" as="style">
<link href="/scss/main.min.723d31f72c8542b0efd4dc916a8b429bb3241885d5c0984bf341c1aad66aed50.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css"/>
<script type="text/javascript"  src="/js/highlight-search.js"></script>
<script type="text/javascript"  src="/js/manage-side-panels.js"></script>
  </head>
  <body class="td-page highlightable">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="217pt" height="232pt" viewBox="0 0 217 232"><g transform="translate(0.000000,232.000000) scale(0.100000,-0.100000)" fill="#000" stroke="none"><path d="M1017 2250c-397-48-698-367-731-775-9-106-3-113 66-87l55 20 11-71c6-39 10-72 9-73s-58-22-127-47c-104-37-124-48-122-64 7-37 56-150 88-205l34-56 66 25 66 26 65-72c206-226 513-322 808-252 367 88 634 417 635 784 0 43-4 77-10 77-5 0-32-9-60-20s-55-20-59-20c-5 0-12 26-16 59-4 32-20 96-36 142s-30 88-31 92c-2 5 54 29 124 55l128 46-31 55c-17 31-33 58-34 59-2 2-31-6-64-19l-61-22-23 29c-81 104-172 178-292 235-140 68-309 97-458 79zm226-299c90-24 136-46 206-101l52-41 61 20 60 20 26-31c15-17 35-44 44-59l17-28-52-19c-29-11-86-32-128-47l-76-27 24-58c26-66 43-144 43-201 0-22 2-39 5-39 2 0 27 9 55 20s55 20 60 20c17 0 10-63-14-131-127-359-580-484-862-237l-35 31-70-24-71-24-30 35c-37 43-97 164-104 212l-6 34 123 46 124 45-3 64c-2 35-5 66-7 68-2 1-27-5-55-14s-53-15-55-14c-2 2 1 29 7 59 32 179 185 352 361 409 112 36 192 39 3e2 12z"/><path d="M134 321c-77-33-95-169-29-231 19-18 36-23 71-23 40 0 51 4 75 30 50 56 47 153-5 202-26 25-80 35-112 22zm82-62c26-29 26-99 0-128-24-26-47-27-77-2-19 15-24 29-24 64 0 76 58 114 101 66z"/><path d="M1172 320c-27-12-44-52-33-82 4-12 31-32 61-47 30-14 58-34 64-43 26-43-50-76-99-44-15 10-26 12-30 6-10-16 4-29 44-40 62-17 114 13 114 65 0 35-19 53-80 81-54 23-67 46-41 72 15 15 62 16 88 2 23-12 35 3 16 19-20 17-77 23-104 11z"/><path d="M350 195V70h25c23 0 25 4 25 45v45h40c76 0 115 40 103 104-8 42-38 56-120 56h-73V195zm134 69c18-18 18-17 10-38-4-11-19-16-50-16-44 0-44 0-44 35 0 33 2 35 34 35 19 0 42-7 50-16z"/><path d="M6e2 195V70h90c83 0 90 2 90 20 0 16-8 19-62 22-63 3-63 3-66 36-3 31-2 32 36 32 36 0 39 2 34 25-4 21-10 25-38 25-30 0-34 3-34 25 0 24 2 25 65 25 58 0 65 2 65 20 0 19-7 20-90 20h-90V195z"/><path d="M850 195c0-117 1-125 20-125 17 0 19 8 22 83l3 82 55-82c41-62 61-83 78-83 22 0 22 2 22 125 0 117-1 125-20 125-17 0-19-8-22-82l-3-82-54 82c-42 65-59 82-77 82-24 0-24 0-24-125z"/><path d="M1360 195c0-104 2-125 15-125 12 0 15 13 15 60v60h65 65v-60c0-47 3-60 15-60 13 0 15 21 15 125s-2 125-15 125c-12 0-15-13-15-55v-55h-65-65v55c0 42-3 55-15 55-13 0-15-21-15-125z"/><path d="M1620 195c0-104 2-125 15-125s15 21 15 125-2 125-15 125-15-21-15-125z"/><path d="M1730 195c0-77 4-125 10-125s10 27 10 60v60h35c19 0 35 5 35 10 0 6-16 10-35 10-35 0-35 0-35 45v45h60c33 0 60 4 60 10s-30 10-70 10h-70V195z"/><path d="M1930 310c0-5 18-10 40-10h40V185c0-70 4-115 10-115s10 45 10 115v115h40c22 0 40 5 40 10 0 6-37 10-90 10s-90-4-90-10z"/></g></svg></span><span class="font-weight-bold">Documentation</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/docs/kubernetes/" ><i class='fas fa-binoculars'></i><span class="active">KUBERNETES DOCUMENTS</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/ansible/" ><i class='fas fa-user-check'></i><span>Ansible</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/azure-devops/" ><i class='fas fa-user-check'></i><span>Azure Devops</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/devops/" ><i class='fas fa-user-check'></i><span>Devops </span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/gitlab/" ><i class='fas fa-user-check'></i><span>Gitlab</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/openshift/" ><i class='fas fa-user-check'></i><span>Openshift</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/terraform/" ><i class='fas fa-user-check'></i><span>Terraform</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
<form class="d-flex align-items-center">
  <input type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.d81df5ea3c42d7ddf1c407fed2af5e96.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="20">
</form>
</div>
</nav>

      <div class="manage-panels">
    <button type="button" class="button-left" id="left-panel-manager" title="Hide sidebar">""</button>
    <button type="button" class="button-right" id="right-panel-manager" title="Hide sidebar">""</button>
</div>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main autonumbering">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            
<div id="td-sidebar-menu" class="td-sidebar__inner">
  <div id="content-mobile">
  <form class="td-sidebar__search d-flex align-items-center">
    
<form class="d-flex align-items-center">
  <input type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.d81df5ea3c42d7ddf1c407fed2af5e96.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="20">
</form>

    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  </div>
  <div id="content-desktop"></div>
  <nav class="collapse td-sidebar-nav foldable-nav" id="td-section-nav">
    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docs-li">
  <a href="/docs/" title="DEVOPS Documents hub" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-docs"><span class="">Docs</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docskubernetes-li">
  <input type="checkbox" id="m-docskubernetes-check" checked/>
  <label for="m-docskubernetes-check"><a href="/docs/kubernetes/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docskubernetes"><i class="fas fa-compass"></i><span class="">KUBERNETES DOCUMENTS</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetespart01-li">
  <input type="checkbox" id="m-docskubernetespart01-check"/>
  <label for="m-docskubernetespart01-check"><a href="/docs/kubernetes/part01/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetespart01"><span class="">Part 1</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetespart02-li">
  <input type="checkbox" id="m-docskubernetespart02-check"/>
  <label for="m-docskubernetespart02-check"><a href="/docs/kubernetes/part02/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetespart02"><span class="">Part 2</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetespart03-li">
  <input type="checkbox" id="m-docskubernetespart03-check"/>
  <label for="m-docskubernetespart03-check"><a href="/docs/kubernetes/part03/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetespart03"><span class="">Part 3</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetespart04-li">
  <input type="checkbox" id="m-docskubernetespart04-check"/>
  <label for="m-docskubernetespart04-check"><a href="/docs/kubernetes/part04/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetespart04"><span class="">Part 4</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetespart05-li">
  <input type="checkbox" id="m-docskubernetespart05-check"/>
  <label for="m-docskubernetespart05-check"><a href="/docs/kubernetes/part05/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetespart05"><span class="">Part 5</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetesdocsmiscellaneouscontainerbasics-li">
  <input type="checkbox" id="m-docskubernetesdocsmiscellaneouscontainerbasics-check"/>
  <label for="m-docskubernetesdocsmiscellaneouscontainerbasics-check"><a href="/docs/kubernetes/docs/miscellaneous/containerbasics/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetesdocsmiscellaneouscontainerbasics"><span class="">Container Basics</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetesdocsmiscellaneoushelm-overview-li">
  <input type="checkbox" id="m-docskubernetesdocsmiscellaneoushelm-overview-check"/>
  <label for="m-docskubernetesdocsmiscellaneoushelm-overview-check"><a href="/docs/kubernetes/docs/miscellaneous/helm-overview/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetesdocsmiscellaneoushelm-overview"><span class="">Helm Overview</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetesdocsmiscellaneouskubernetes-rbac-li">
  <input type="checkbox" id="m-docskubernetesdocsmiscellaneouskubernetes-rbac-check"/>
  <label for="m-docskubernetesdocsmiscellaneouskubernetes-rbac-check"><a href="/docs/kubernetes/docs/miscellaneous/kubernetes-rbac/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetesdocsmiscellaneouskubernetes-rbac"><span class="">Kubernetes RBAC</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetesdocsmiscellaneouskubernetes-on-centos-li">
  <input type="checkbox" id="m-docskubernetesdocsmiscellaneouskubernetes-on-centos-check"/>
  <label for="m-docskubernetesdocsmiscellaneouskubernetes-on-centos-check"><a href="/docs/kubernetes/docs/miscellaneous/kubernetes-on-centos/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetesdocsmiscellaneouskubernetes-on-centos"><span class="">Kubernetes-on-Centos</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetesdocsmiscellaneouskuberneteshardway-li">
  <input type="checkbox" id="m-docskubernetesdocsmiscellaneouskuberneteshardway-check"/>
  <label for="m-docskubernetesdocsmiscellaneouskuberneteshardway-check"><a href="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" class="align-left pl-0  active td-sidebar-link td-sidebar-link__page" id="m-docskubernetesdocsmiscellaneouskuberneteshardway"><span class="td-sidebar-nav-active-item">Kubernets Installation From Scatch on rocky 9</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docskubernetesdocsmiscellaneousminio-li">
  <input type="checkbox" id="m-docskubernetesdocsmiscellaneousminio-check"/>
  <label for="m-docskubernetesdocsmiscellaneousminio-check"><a href="/docs/kubernetes/docs/miscellaneous/minio/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docskubernetesdocsmiscellaneousminio"><span class="">The Object Store for AI Data Infrastructure</span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsansible-li">
  <input type="checkbox" id="m-docsansible-check"/>
  <label for="m-docsansible-check"><a href="/docs/ansible/" title="Configuration Management Tool" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsansible"><i class="fas fa-user-check"></i><span class="">Ansible</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsazure-devops-li">
  <input type="checkbox" id="m-docsazure-devops-check"/>
  <label for="m-docsazure-devops-check"><a href="/docs/azure-devops/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsazure-devops"><i class="fas fa-user-check"></i><span class="">Azure Devops</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsazure-devopsaks-deployment-li">
  <input type="checkbox" id="m-docsazure-devopsaks-deployment-check"/>
  <label for="m-docsazure-devopsaks-deployment-check"><a href="/docs/azure-devops/aks-deployment/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsazure-devopsaks-deployment"><span class="">AKS Deployment</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsazure-devopsazure-container-registry-li">
  <input type="checkbox" id="m-docsazure-devopsazure-container-registry-check"/>
  <label for="m-docsazure-devopsazure-container-registry-check"><a href="/docs/azure-devops/azure-container-registry/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsazure-devopsazure-container-registry"><span class="">Azure Container Registry</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsazure-devopsazure-devopsagent-li">
  <input type="checkbox" id="m-docsazure-devopsazure-devopsagent-check"/>
  <label for="m-docsazure-devopsazure-devopsagent-check"><a href="/docs/azure-devops/azure-devopsagent/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsazure-devopsazure-devopsagent"><span class="">Azure Devops Pipeline Agent</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsazure-devopsazure-devops-pipeline-li">
  <input type="checkbox" id="m-docsazure-devopsazure-devops-pipeline-check"/>
  <label for="m-docsazure-devopsazure-devops-pipeline-check"><a href="/docs/azure-devops/azure-devops-pipeline/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsazure-devopsazure-devops-pipeline"><span class="">Azure Devops Pipeline Basics</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsazure-devopsazure-dns-li">
  <input type="checkbox" id="m-docsazure-devopsazure-dns-check"/>
  <label for="m-docsazure-devopsazure-dns-check"><a href="/docs/azure-devops/azure-dns/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsazure-devopsazure-dns"><span class="">Azure DNS</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsazure-devopscertmanager-li">
  <input type="checkbox" id="m-docsazure-devopscertmanager-check"/>
  <label for="m-docsazure-devopscertmanager-check"><a href="/docs/azure-devops/certmanager/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsazure-devopscertmanager"><span class="">Cert Manager</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsazure-devopsingresscontroller-li">
  <input type="checkbox" id="m-docsazure-devopsingresscontroller-check"/>
  <label for="m-docsazure-devopsingresscontroller-check"><a href="/docs/azure-devops/ingresscontroller/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsazure-devopsingresscontroller"><span class="">IngressController</span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsdevops-li">
  <input type="checkbox" id="m-docsdevops-check"/>
  <label for="m-docsdevops-check"><a href="/docs/devops/" title="Devops" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsdevops"><i class="fas fa-user-check"></i><span class="">Devops </span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdevopsdevops-advance-li">
  <input type="checkbox" id="m-docsdevopsdevops-advance-check"/>
  <label for="m-docsdevopsdevops-advance-check"><a href="/docs/devops/devops-advance/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsdevopsdevops-advance"><span class="">Devops for Advance Level</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdevopsdevopsl1-li">
  <input type="checkbox" id="m-docsdevopsdevopsl1-check"/>
  <label for="m-docsdevopsdevopsl1-check"><a href="/docs/devops/devopsl1/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsdevopsdevopsl1"><span class="">Devops for Begineers</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdevopselk-stack-li">
  <input type="checkbox" id="m-docsdevopselk-stack-check"/>
  <label for="m-docsdevopselk-stack-check"><a href="/docs/devops/elk-stack/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsdevopselk-stack"><span class="">ELK statck </span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdevopspostgresql-li">
  <input type="checkbox" id="m-docsdevopspostgresql-check"/>
  <label for="m-docsdevopspostgresql-check"><a href="/docs/devops/postgresql/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsdevopspostgresql"><span class="">Postgres Installation </span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsgitlab-li">
  <input type="checkbox" id="m-docsgitlab-check"/>
  <label for="m-docsgitlab-check"><a href="/docs/gitlab/" title="Project Management Tool" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsgitlab"><i class="fas fa-user-check"></i><span class="">Gitlab</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsterraform-li">
  <input type="checkbox" id="m-docsterraform-check"/>
  <label for="m-docsterraform-check"><a href="/docs/terraform/" title="Infrastracture as a Code" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsterraform"><i class="fas fa-user-check"></i><span class="">Terraform</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsterraformdiscussions-li">
  <input type="checkbox" id="m-docsterraformdiscussions-check"/>
  <label for="m-docsterraformdiscussions-check"><a href="/docs/terraform/discussions/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsterraformdiscussions"><span class="">Discussions</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsterraformterraform-with-aws-li">
  <input type="checkbox" id="m-docsterraformterraform-with-aws-check"/>
  <label for="m-docsterraformterraform-with-aws-check"><a href="/docs/terraform/terraform-with-aws/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsterraformterraform-with-aws"><span class="">Terraform with AWS</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsterraformterraform-with-azure-li">
  <input type="checkbox" id="m-docsterraformterraform-with-azure-check"/>
  <label for="m-docsterraformterraform-with-azure-check"><a href="/docs/terraform/terraform-with-azure/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsterraformterraform-with-azure"><span class="">Terraform with Azure</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsterraformterraform-with-gcp-li">
  <input type="checkbox" id="m-docsterraformterraform-with-gcp-check"/>
  <label for="m-docsterraformterraform-with-gcp-check"><a href="/docs/terraform/terraform-with-gcp/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsterraformterraform-with-gcp"><span class="">Terraform with Google Cloud</span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsopenshift-li">
  <input type="checkbox" id="m-docsopenshift-check"/>
  <label for="m-docsopenshift-check"><a href="/docs/openshift/" title="Redhat Container Platform" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-docsopenshift"><i class="fas fa-user-check"></i><span class="">Openshift</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshiftopenshift-baremetalmd-li">
  <input type="checkbox" id="m-docsopenshiftopenshift-baremetalmd-check"/>
  <label for="m-docsopenshiftopenshift-baremetalmd-check"><a href="/docs/openshift/openshift-baremetal.md/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshiftopenshift-baremetalmd"><span class="">Openshift Baremetal</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshiftocpsetup-li">
  <input type="checkbox" id="m-docsopenshiftocpsetup-check"/>
  <label for="m-docsopenshiftocpsetup-check"><a href="/docs/openshift/ocpsetup/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshiftocpsetup"><span class="">Openshift Installation and Upgradation</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshiftprerequisites-li">
  <input type="checkbox" id="m-docsopenshiftprerequisites-check"/>
  <label for="m-docsopenshiftprerequisites-check"><a href="/docs/openshift/prerequisites./" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshiftprerequisites"><span class="">OpenShift Prerequisites</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshiftopenshifttasks-li">
  <input type="checkbox" id="m-docsopenshiftopenshifttasks-check"/>
  <label for="m-docsopenshiftopenshifttasks-check"><a href="/docs/openshift/openshifttasks/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshiftopenshifttasks"><span class="">OpenShift Tasks</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshifttoc-li">
  <input type="checkbox" id="m-docsopenshifttoc-check"/>
  <label for="m-docsopenshifttoc-check"><a href="/docs/openshift/toc/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshifttoc"><span class="">Openshift TOC</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshiftpart-1-li">
  <input type="checkbox" id="m-docsopenshiftpart-1-check"/>
  <label for="m-docsopenshiftpart-1-check"><a href="/docs/openshift/part-1/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshiftpart-1"><span class="">Part 1</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshiftpart-2-li">
  <input type="checkbox" id="m-docsopenshiftpart-2-check"/>
  <label for="m-docsopenshiftpart-2-check"><a href="/docs/openshift/part-2/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshiftpart-2"><span class="">Part 2</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsopenshiftopenid-azuread-li">
  <input type="checkbox" id="m-docsopenshiftopenid-azuread-check"/>
  <label for="m-docsopenshiftopenid-azuread-check"><a href="/docs/openshift/openid-azuread/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-docsopenshiftopenid-azuread"><span class="">Use and configure OpenID connect with Azure AD</span></a></label>
  
</li>
  </ul>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            

    <div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
        <div class="toc-title">Actions</div>
        <a href="/edit/master/content/docs/kubernetes/docs/miscellaneous/kubernetesHardWay.md" target="_blank" rel="noopener"><i class="fa fa-edit fa-fw"></i> Contribute to this page</a>
        <a href="/issues/new?issue%5Btitle=%f0%9f%93%83%20docs:%20update%20page%20docs/kubernetes/docs/miscellaneous/kubernetesHardWay.md" target="_blank" rel="noopener"><i class="fab fa-gitlab fa-fw"></i> Create a documentation issue</a>
       
    </div>

            
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0 right-menu-toc">

    
        
            <div class="toc-title">Table of content</div>
            <div class="td-toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#topics">Topics</a>
      <ul>
        <li><a href="#downloading-release-binaries">Downloading Release Binaries</a></li>
        <li><a href="#download-server-binaries-on-master-node">Download Server Binaries on master node</a></li>
        <li><a href="#download-node-binaries-on-worker-node">Download Node Binaries on Worker node</a></li>
        <li><a href="#configuring-kubernetes-certificate-authority">Configuring kubernetes Certificate Authority</a>
          <ul>
            <li><a href="#create-base-directory-were-all-the-certificates-and-keys-will-be-stored">Create base directory were all the certificates and keys will be stored</a></li>
            <li><a href="#creating-a-private-key-for-certificate-authority">Creating a private key for Certificate Authority</a></li>
            <li><a href="#creating-csr">Creating CSR</a></li>
            <li><a href="#self-sign-the-csr">Self-Sign the CSR</a></li>
            <li><a href="#see-contents-of-certificate">See Contents of Certificate</a></li>
            <li><a href="#remove-csr">Remove CSR</a></li>
          </ul>
        </li>
        <li><a href="#installing-etcdhttpsgithubcometcd-ioetcdreleases"><a href="https://github.com/etcd-io/etcd/releases">Installing ETCD</a></a>
          <ul>
            <li><a href="#documentation-referredhttpsetcdiodocsv35op-guideconfiguration"><a href="https://etcd.io/docs/v3.5/op-guide/configuration/">Documentation Referred</a></a></li>
            <li><a href="#pre-requisite-set-server-ip-variable">Pre-Requisite: Set SERVER-IP variable</a></li>
            <li><a href="#configure-the-certificates">Configure the Certificates:</a></li>
            <li><a href="#note-replace-the-value-associated-with-ip1-in-the-below-step">Note: Replace the value associated with IP.1 in the below step.</a></li>
            <li><a href="#copy-the-certificates-and-key-to-etcetcd">Copy the Certificates and Key to /etc/etcd</a></li>
            <li><a href="#copy-the-etcd-and-etcdctl-binaries-to-the-path">Copy the ETCD and ETCDCTL Binaries to the Path</a></li>
            <li><a href="#configure-the-systemd-file">Configure the systemd File</a></li>
            <li><a href="#create-a-service-file">Create a service file:</a></li>
            <li><a href="#start-service">Start Service:</a></li>
            <li><a href="#verification-commands">Verification Commands:</a></li>
          </ul>
        </li>
        <li><a href="#configuring-api-server">Configuring API Server</a>
          <ul>
            <li><a href="#reference-documentation">Reference Documentation</a></li>
            <li><a href="#prerequisites">PreRequisites</a></li>
            <li><a href="#step-1-generate-configuration-file-for-csr-creation">Step 1. Generate Configuration File for CSR Creation.</a></li>
            <li><a href="#generate-certificates-for-api-server">Generate Certificates for API Server</a></li>
            <li><a href="#generate-certificate-for-service-account">Generate Certificate for Service Account:</a></li>
            <li><a href="#copy-the-certificate-files-to-varlibkubernetes-directory">Copy the certificate files to /var/lib/kubernetes directory</a></li>
            <li><a href="#creating-encryption-key-and-configuration">Creating Encryption key and Configuration</a></li>
            <li><a href="#creating-systemd-service-file">Creating Systemd service file:</a></li>
            <li><a href="#start-the-kube-api-service">Start the kube-api service:</a></li>
          </ul>
        </li>
        <li><a href="#configuring-controller-manager">Configuring Controller Manager</a>
          <ul>
            <li><a href="#generate-certificates">Generate Certificates:</a></li>
            <li><a href="#generating-kubeconfig">Generating KubeConfig</a></li>
            <li><a href="#copying-the-files-to-kubernetes-directory">Copying the files to kubernetes directory</a></li>
            <li><a href="#configuring-systemd-service-file">Configuring SystemD service file:</a></li>
            <li><a href="#start-controller-manager">Start Controller Manager:</a></li>
          </ul>
        </li>
        <li><a href="#configuring-scheduler">Configuring Scheduler</a>
          <ul>
            <li><a href="#generate-certificates-1">Generate Certificates:</a></li>
            <li><a href="#generate-kubeconfig-file">Generate Kubeconfig file:</a></li>
            <li><a href="#copy-the-scheduler-kubeconfig">Copy the scheduler kubeconfig</a></li>
            <li><a href="#configuring-systemd-service">Configuring systemd service:</a></li>
            <li><a href="#verification">Verification:</a></li>
          </ul>
        </li>
        <li><a href="#validating-cluster-status">Validating Cluster Status</a>
          <ul>
            <li><a href="#generate-certificate-for-administrator-user">Generate Certificate for Administrator User</a></li>
            <li><a href="#create-kubeconfig-file">Create KubeConfig file:</a></li>
            <li><a href="#verify-cluster-status">Verify Cluster Status</a></li>
            <li><a href="#verify-kubernetes-objects-creation">Verify Kubernetes Objects Creation</a></li>
          </ul>
        </li>
        <li><a href="#worker-node-configuration">Worker Node Configuration</a>
          <ul>
            <li><a href="#configure-container-runtime-worker-node">Configure Container Runtime. (WORKER NODE)</a></li>
            <li><a href="#pre-requisites---2-worker-node">Pre-Requisites - 2: (WORKER NODE)</a></li>
            <li><a href="#generate-kubelet-certificate-for-worker-node-master-node">Generate Kubelet Certificate for Worker Node. (MASTER NODE)</a></li>
            <li><a href="#step-2-generate-kube-proxy-certificate-master-node">Step 2: Generate kube-proxy certificate: (MASTER NODE)</a></li>
            <li><a href="#step-3-copy-certificates-to-worker-node">Step 3: Copy Certificates to Worker Node:</a>
              <ul>
                <li><a href="#--worker-node">- Worker Node:</a></li>
                <li><a href="#--master-node">- Master Node:</a></li>
                <li><a href="#--worker-node-1">- Worker Node:</a></li>
              </ul>
            </li>
            <li><a href="#step-4-move-certificates-to-specific-location-worker-node">Step 4: Move Certificates to Specific Location. (WORKER NODE)</a></li>
            <li><a href="#step-5-generate-kubelet-configuration-yaml-file-worker-node">Step 5: Generate Kubelet Configuration YAML File: (WORKER NODE)</a></li>
            <li><a href="#step-6-generate-systemd-service-file-for-kubelet-worker-node">Step 6: Generate Systemd service file for kubelet: (WORKER NODE)</a></li>
            <li><a href="#step-7-generate-the-kubeconfig-file-for-kubelet-worker-node">Step 7: Generate the Kubeconfig file for Kubelet (WORKER NODE)</a></li>
          </ul>
        </li>
        <li><a href="#part-2---kube-proxy">Part 2 - Kube-Proxy</a>
          <ul>
            <li><a href="#step-1-copy-kube-proxy-certificate-to-directory--worker-node">Step 1: Copy Kube Proxy Certificate to Directory:  (WORKER NODE)</a></li>
            <li><a href="#step-2-generate-kubeconfig-file">Step 2: Generate KubeConfig file:</a></li>
            <li><a href="#step-3-generate-kube-proxy-configuration-file-worker-node">Step 3: Generate kube-proxy configuration file: (WORKER NODE)</a></li>
            <li><a href="#step-4-create-kube-proxy-service-file-worker-node">Step 4: Create kube-proxy service file: (WORKER NODE)</a></li>
            <li><a href="#worker-node">WORKER NODE</a></li>
            <li><a href="#step-6-master-node">Step 6: (MASTER NODE)</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
        
    

</div>
          </aside>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="/docs/">Docs</a>
  </li>
  <li class="breadcrumb-item">
    <a href="/docs/kubernetes/">KUBERNETES DOCUMENTS</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">
    <a href="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/">Kubernets Installation From Scatch on rocky 9</a>
  </li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>Kubernets Installation From Scatch on rocky 9</h1>
	
	<header class="article-meta">
		

  
    


  
    


  

		
	</header>    
	<!-- end-chunk -->
<!-- begin-chunk data-anchor="topics" data-heading="Topics" data-level="2" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h2 id="topics">Topics</h2><ul>
<li>Downloading Release Binaries</li>
<li>Configuring CA</li>
<li>Installing ETCD</li>
<li>Configuring API Server</li>
<li>Configuring Controller Manager</li>
<li>Configuring Scheduler</li>
<li>Validating Cluster Status</li>
<li>Worker Node Configuration</li>
<li>Configuring Networking</li>
<li>API to Kubelet RBAC</li>
<li>Configuring DNS</li>
<li>Kubelet Preferred Instance Type</li>
</ul>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="downloading-release-binaries" data-heading="Downloading Release Binaries" data-level="3" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h3 id="downloading-release-binaries">Downloading Release Binaries</h3><ul>
<li>Kubernetes Binaries
<ul>
<li>Source Code</li>
<li>Client Binaries</li>
<li>Server Binaries</li>
<li>Node Binaries</li>
<li>Container Images</li>
</ul>
</li>
<li><a href="https://github.com/kubernetes/kubernetes/tree/master/CHANGELOG" target="_blank" rel="noopener">Download release Binaries</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/tree/master/CHANGELOG" target="_blank" rel="noopener">Download Etcd</a></li>
<li>Install wget and unzip</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>yum install wget unzip <span style="color:#f92672">-</span>y
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="download-server-binaries-on-master-node" data-heading="Download Server Binaries on master node" data-level="3" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h3 id="download-server-binaries-on-master-node">Download Server Binaries on master node</h3><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir /root/binaries
</span></span><span style="display:flex;"><span>cd /root/binaries
</span></span><span style="display:flex;"><span>wget https://dl.k8s.io/v1.28.7/kubernetes-server-linux-amd64.tar.gz 
</span></span><span style="display:flex;"><span>tar -xzvf kubernetes-server-linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>cd /root/binaries/kubernetes/server/bin/
</span></span></code></pre></div><ul>
<li>Check all master binaries</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>ls <span style="color:#f92672">-</span>l <span style="color:#e6db74">/root/</span>binaries<span style="color:#e6db74">/kubernetes/s</span>erver<span style="color:#f92672">/</span>bin
</span></span></code></pre></div><ul>
<li>Download etcd in the same folder</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>cd <span style="color:#e6db74">/root/</span>binaries<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>wget https:<span style="color:#e6db74">//gi</span>thub<span style="color:#f92672">.</span>com<span style="color:#e6db74">/etcd-io/</span>etcd<span style="color:#e6db74">/releases/</span>download<span style="color:#e6db74">/v3.5.12/</span>etcd<span style="color:#f92672">-</span>v3<span style="color:#ae81ff">.5.12</span><span style="color:#f92672">-</span>darwin<span style="color:#f92672">-</span>amd64<span style="color:#f92672">.</span>zip
</span></span><span style="display:flex;"><span>unzip etcd<span style="color:#f92672">-</span>v3<span style="color:#ae81ff">.5.12</span><span style="color:#f92672">-</span>darwin<span style="color:#f92672">-</span>amd64<span style="color:#f92672">.</span>zip
</span></span><span style="display:flex;"><span>cd etcd<span style="color:#f92672">-</span>v3<span style="color:#ae81ff">.5.12</span><span style="color:#f92672">-</span>darwin<span style="color:#f92672">-</span>amd64<span style="color:#f92672">/</span>
</span></span></code></pre></div><ul>
<li>Check etcd relatated binaries</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>ls <span style="color:#f92672">-</span>l <span style="color:#e6db74">/root/</span>binaries<span style="color:#e6db74">/tcd-v3.5.12-darwin-amd64/</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="download-node-binaries-on-worker-node" data-heading="Download Node Binaries on Worker node" data-level="3" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h3 id="download-node-binaries-on-worker-node">Download Node Binaries on Worker node</h3><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir /root/binaries
</span></span><span style="display:flex;"><span>cd /root/binaries
</span></span><span style="display:flex;"><span>wget https://dl.k8s.io/v1.28.7/kubernetes-node-linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>tar -xzvf kubernetes-node-linux-amd64.tar.gz
</span></span></code></pre></div><ul>
<li>Check all node binaries</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>ls <span style="color:#f92672">-</span>l  <span style="color:#e6db74">/root/</span>binaries<span style="color:#e6db74">/node/</span>bin
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="configuring-kubernetes-certificate-authority" data-heading="Configuring kubernetes Certificate Authority" data-level="3" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h3 id="configuring-kubernetes-certificate-authority">Configuring kubernetes Certificate Authority</h3><!-- end-chunk -->
<!-- begin-chunk data-anchor="create-base-directory-were-all-the-certificates-and-keys-will-be-stored" data-heading="Create base directory were all the certificates and keys will be stored" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="create-base-directory-were-all-the-certificates-and-keys-will-be-stored">Create base directory were all the certificates and keys will be stored</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir /root/certificates
</span></span><span style="display:flex;"><span>cd /root/certificates
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="creating-a-private-key-for-certificate-authority" data-heading="Creating a private key for Certificate Authority" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="creating-a-private-key-for-certificate-authority">Creating a private key for Certificate Authority</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>openssl genrsa -out ca.key <span style="color:#ae81ff">2048</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="creating-csr" data-heading="Creating CSR" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="creating-csr">Creating CSR</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>openssl req -new -key ca.key -subj <span style="color:#e6db74">&#34;/CN=KUBERNETES-CA&#34;</span> -out ca.csr
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="self-sign-the-csr" data-heading="Self-Sign the CSR" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="self-sign-the-csr">Self-Sign the CSR</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>openssl x509 -req -in ca.csr -signkey ca.key -CAcreateserial  -out ca.crt -days <span style="color:#ae81ff">1000</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="see-contents-of-certificate" data-heading="See Contents of Certificate" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="see-contents-of-certificate">See Contents of Certificate</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>openssl x509 -in ca.crt -text -noout
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="remove-csr" data-heading="Remove CSR" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="remove-csr">Remove CSR</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>rm -f ca.csr
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="installing-etcdhttpsgithubcometcd-ioetcdreleases" data-heading="<a href=\"https://github.com/etcd-io/etcd/releases\" target=\"_blank\" rel=\"noopener\">Installing ETCD</a>" data-level="3" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h3 id="installing-etcdhttpsgithubcometcd-ioetcdreleases"><a href="https://github.com/etcd-io/etcd/releases" target="_blank" rel="noopener">Installing ETCD</a></h3><!-- end-chunk -->
<!-- begin-chunk data-anchor="documentation-referredhttpsetcdiodocsv35op-guideconfiguration" data-heading="<a href=\"https://etcd.io/docs/v3.5/op-guide/configuration/\" target=\"_blank\" rel=\"noopener\">Documentation Referred</a>" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="documentation-referredhttpsetcdiodocsv35op-guideconfiguration"><a href="https://etcd.io/docs/v3.5/op-guide/configuration/" target="_blank" rel="noopener">Documentation Referred</a></h4><!-- end-chunk -->
<!-- begin-chunk data-anchor="pre-requisite-set-server-ip-variable" data-heading="Pre-Requisite: Set SERVER-IP variable" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="pre-requisite-set-server-ip-variable">Pre-Requisite: Set SERVER-IP variable</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>SERVER_IP<span style="color:#f92672">=</span>172.16.16.110 <span style="color:#f92672">(</span>change this to your IP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>echo $SERVER_IP
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="configure-the-certificates" data-heading="Configure the Certificates:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="configure-the-certificates">Configure the Certificates:</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /root/certificates/
</span></span><span style="display:flex;"><span>openssl genrsa -out etcd.key <span style="color:#ae81ff">2048</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="note-replace-the-value-associated-with-ip1-in-the-below-step" data-heading="Note: Replace the value associated with IP.1 in the below step." data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="note-replace-the-value-associated-with-ip1-in-the-below-step">Note: Replace the value associated with IP.1 in the below step.</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat &gt; etcd.cnf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[req]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">req_extensions = v3_req
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">distinguished_name = req_distinguished_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[req_distinguished_name]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ v3_req ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basicConstraints = CA:FALSE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">keyUsage = nonRepudiation, digitalSignature, keyEncipherment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjectAltName = @alt_names
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[alt_names]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IP.1 = ${SERVER_IP}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IP.2 = 127.0.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>openssl req -new -key etcd.key -subj <span style="color:#e6db74">&#34;/CN=etcd&#34;</span> -out etcd.csr -config etcd.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>openssl x509 -req -in etcd.csr -CA ca.crt -CAkey ca.key -CAcreateserial  -out etcd.crt -extensions v3_req -extfile etcd.cnf -days <span style="color:#ae81ff">1000</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="copy-the-certificates-and-key-to-etcetcd" data-heading="Copy the Certificates and Key to /etc/etcd" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="copy-the-certificates-and-key-to-etcetcd">Copy the Certificates and Key to /etc/etcd</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir /etc/etcd
</span></span><span style="display:flex;"><span>cp etcd.crt etcd.key ca.crt /etc/etcd
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="copy-the-etcd-and-etcdctl-binaries-to-the-path" data-heading="Copy the ETCD and ETCDCTL Binaries to the Path" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="copy-the-etcd-and-etcdctl-binaries-to-the-path">Copy the ETCD and ETCDCTL Binaries to the Path</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /root/binaries/etcd-v3.5.12-darwin-amd64/
</span></span><span style="display:flex;"><span>cp etcd etcdctl /usr/local/bin/
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="configure-the-systemd-file" data-heading="Configure the systemd File" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="configure-the-systemd-file">Configure the systemd File</h4><!-- end-chunk -->
<!-- begin-chunk data-anchor="create-a-service-file" data-heading="Create a service file:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="create-a-service-file">Create a service file:</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /etc/systemd/system/etcd.service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=etcd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://github.com/coreos
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/usr/local/bin/etcd \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --name master-1 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --cert-file=/etc/etcd/etcd.crt \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --key-file=/etc/etcd/etcd.key \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --peer-cert-file=/etc/etcd/etcd.crt \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --peer-key-file=/etc/etcd/etcd.key \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --trusted-ca-file=/etc/etcd/ca.crt \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --peer-trusted-ca-file=/etc/etcd/ca.crt \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --peer-client-cert-auth \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --client-cert-auth \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --initial-advertise-peer-urls https://${SERVER_IP}:2380 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --listen-peer-urls https://${SERVER_IP}:2380 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --listen-client-urls https://${SERVER_IP}:2379,https://127.0.0.1:2379 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --advertise-client-urls https://${SERVER_IP}:2379 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --initial-cluster-token etcd-cluster-0 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --initial-cluster master-1=https://${SERVER_IP}:2380 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --initial-cluster-state new \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --data-dir=/var/lib/etcd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RestartSec=5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="start-service" data-heading="Start Service:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="start-service">Start Service:</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>systemctl start etcd
</span></span><span style="display:flex;"><span>systemctl status etcd
</span></span><span style="display:flex;"><span>systemctl enable etcd
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="verification-commands" data-heading="Verification Commands:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="verification-commands">Verification Commands:</h4><p>When we try with etcdctl &ndash;endpoints=https://127.0.0.1:2379 get foo, it gives unknown certificate authority.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ETCDCTL_API<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> etcdctl --endpoints<span style="color:#f92672">=</span>https://127.0.0.1:2379 --cacert<span style="color:#f92672">=</span>/etc/etcd/ca.crt --cert<span style="color:#f92672">=</span>/etc/etcd/etcd.crt --key<span style="color:#f92672">=</span>/etc/etcd/etcd.key put test <span style="color:#e6db74">&#34;Test&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ETCDCTL_API<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> etcdctl --endpoints<span style="color:#f92672">=</span>https://127.0.0.1:2379 --cacert<span style="color:#f92672">=</span>/etc/etcd/ca.crt --cert<span style="color:#f92672">=</span>/etc/etcd/etcd.crt --key<span style="color:#f92672">=</span>/etc/etcd/etcd.key get test
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="configuring-api-server" data-heading="Configuring API Server" data-level="3" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h3 id="configuring-api-server">Configuring API Server</h3><!-- end-chunk -->
<!-- begin-chunk data-anchor="reference-documentation" data-heading="Reference Documentation" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="reference-documentation">Reference Documentation</h4><p><a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/</a></p>
<p><a href="https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/" target="_blank" rel="noopener">https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/</a></p>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="prerequisites" data-heading="PreRequisites" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="prerequisites">PreRequisites</h4><ul>
<li>Move the kube-apiserver binary to /usr/local/bin directory.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /root/binaries/kubernetes/server/bin/
</span></span><span style="display:flex;"><span>cp kube-apiserver /usr/local/bin/
</span></span></code></pre></div><p>Ensure that the SERVER_IP variable is still set.</p>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="step-1-generate-configuration-file-for-csr-creation" data-heading="Step 1. Generate Configuration File for CSR Creation." data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="step-1-generate-configuration-file-for-csr-creation">Step 1. Generate Configuration File for CSR Creation.</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /root/certificates
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee api.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[req]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">req_extensions = v3_req
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">distinguished_name = req_distinguished_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[req_distinguished_name]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ v3_req ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basicConstraints = CA:FALSE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">keyUsage = nonRepudiation, digitalSignature, keyEncipherment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjectAltName = @alt_names
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[alt_names]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DNS.1 = kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DNS.2 = kubernetes.default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DNS.3 = kubernetes.default.svc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DNS.4 = kubernetes.default.svc.cluster.local
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IP.1 = 127.0.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IP.2 = ${SERVER_IP}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IP.3 = 10.0.2.15
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="generate-certificates-for-api-server" data-heading="Generate Certificates for API Server" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="generate-certificates-for-api-server">Generate Certificates for API Server</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>openssl genrsa -out kube-api.key <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>openssl req -new -key kube-api.key -subj <span style="color:#e6db74">&#34;/CN=kube-apiserver&#34;</span> -out kube-api.csr -config api.conf
</span></span><span style="display:flex;"><span>openssl x509 -req -in kube-api.csr -CA ca.crt -CAkey ca.key -CAcreateserial  -out kube-api.crt -extensions v3_req -extfile api.conf -days <span style="color:#ae81ff">1000</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="generate-certificate-for-service-account" data-heading="Generate Certificate for Service Account:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="generate-certificate-for-service-account">Generate Certificate for Service Account:</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>openssl genrsa -out service-account.key <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>openssl req -new -key service-account.key -subj <span style="color:#e6db74">&#34;/CN=service-accounts&#34;</span> -out service-account.csr
</span></span><span style="display:flex;"><span>openssl x509 -req -in service-account.csr -CA ca.crt -CAkey ca.key -CAcreateserial  -out service-account.crt -days <span style="color:#ae81ff">100</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="copy-the-certificate-files-to-varlibkubernetes-directory" data-heading="Copy the certificate files to /var/lib/kubernetes directory" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="copy-the-certificate-files-to-varlibkubernetes-directory">Copy the certificate files to /var/lib/kubernetes directory</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir /var/lib/kubernetes
</span></span><span style="display:flex;"><span>cp etcd.crt etcd.key ca.crt kube-api.key kube-api.crt service-account.crt service-account.key /var/lib/kubernetes
</span></span><span style="display:flex;"><span>ls /var/lib/kubernetes
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="creating-encryption-key-and-configuration" data-heading="Creating Encryption key and Configuration" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="creating-encryption-key-and-configuration">Creating Encryption key and Configuration</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ENCRYPTION_KEY<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>head -c <span style="color:#ae81ff">32</span> /dev/urandom | base64<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat &gt; encryption-at-rest.yaml <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: EncryptionConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">resources:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - resources:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - secrets
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    providers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - aescbc:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          keys:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            - name: key1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              secret: ${ENCRYPTION_KEY}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - identity: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cp encryption-at-rest.yaml /var/lib/kubernetes/encryption-at-rest.yaml
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="creating-systemd-service-file" data-heading="Creating Systemd service file:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="creating-systemd-service-file">Creating Systemd service file:</h4><p>Systemd file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /etc/systemd/system/kube-apiserver.service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes API Server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://github.com/kubernetes/kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/usr/local/bin/kube-apiserver \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--advertise-address=${SERVER_IP} \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--allow-privileged=true \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--authorization-mode=Node,RBAC \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--client-ca-file=/var/lib/kubernetes/ca.crt \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--enable-admission-plugins=NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--enable-bootstrap-token-auth=true \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--etcd-cafile=/var/lib/kubernetes/ca.crt \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--etcd-certfile=/var/lib/kubernetes/etcd.crt \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--etcd-keyfile=/var/lib/kubernetes/etcd.key \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--etcd-servers=https://127.0.0.1:2379 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--kubelet-client-certificate=/var/lib/kubernetes/kube-api.crt \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--kubelet-client-key=/var/lib/kubernetes/kube-api.key \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-account-key-file=/var/lib/kubernetes/service-account.crt \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-cluster-ip-range=10.32.0.0/24 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--tls-cert-file=/var/lib/kubernetes/kube-api.crt \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--tls-private-key-file=/var/lib/kubernetes/kube-api.key \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--requestheader-client-ca-file=/var/lib/kubernetes/ca.crt \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-node-port-range=30000-32767 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--audit-log-maxage=30 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--audit-log-maxbackup=3 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--audit-log-maxsize=100 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--audit-log-path=/var/log/kube-api-audit.log \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--bind-address=0.0.0.0 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--event-ttl=1h \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-account-key-file=/var/lib/kubernetes/service-account.crt \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-account-signing-key-file=/var/lib/kubernetes/service-account.key \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-account-issuer=https://${SERVER_IP}:6443 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--encryption-provider-config=/var/lib/kubernetes/encryption-at-rest.yaml \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--v=2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RestartSec=5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="start-the-kube-api-service" data-heading="Start the kube-api service:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="start-the-kube-api-service">Start the kube-api service:</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>systemctl start kube-apiserver
</span></span><span style="display:flex;"><span>systemctl status kube-apiserver
</span></span><span style="display:flex;"><span>systemctl enable kube-apiserver
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="configuring-controller-manager" data-heading="Configuring Controller Manager" data-level="3" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h3 id="configuring-controller-manager">Configuring Controller Manager</h3><!-- end-chunk -->
<!-- begin-chunk data-anchor="generate-certificates" data-heading="Generate Certificates:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="generate-certificates">Generate Certificates:</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /root/certificates
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>openssl genrsa -out kube-controller-manager.key <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>openssl req -new -key kube-controller-manager.key -subj <span style="color:#e6db74">&#34;/CN=system:kube-controller-manager&#34;</span> -out kube-controller-manager.csr
</span></span><span style="display:flex;"><span>openssl x509 -req -in kube-controller-manager.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out kube-controller-manager.crt -days <span style="color:#ae81ff">1000</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="generating-kubeconfig" data-heading="Generating KubeConfig" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="generating-kubeconfig">Generating KubeConfig</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cp /root/binaries/kubernetes/server/bin/kubectl /usr/local/bin
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl config set-cluster kubernetes-from-scratch <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --certificate-authority<span style="color:#f92672">=</span>ca.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --server<span style="color:#f92672">=</span>https://127.0.0.1:6443 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>kube-controller-manager.kubeconfig
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl config set-cluster kubernetes-from-scratch <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --certificate-authority<span style="color:#f92672">=</span>ca.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --server<span style="color:#f92672">=</span>https://127.0.0.1:6443 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>kube-controller-manager.kubeconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl config set-credentials system:kube-controller-manager <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --client-certificate<span style="color:#f92672">=</span>kube-controller-manager.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --client-key<span style="color:#f92672">=</span>kube-controller-manager.key <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>kube-controller-manager.kubeconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl config set-context default <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --cluster<span style="color:#f92672">=</span>kubernetes-from-scratch <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --user<span style="color:#f92672">=</span>system:kube-controller-manager <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>kube-controller-manager.kubeconfig
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl config use-context default --kubeconfig<span style="color:#f92672">=</span>kube-controller-manager.kubeconfig
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="copying-the-files-to-kubernetes-directory" data-heading="Copying the files to kubernetes directory" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="copying-the-files-to-kubernetes-directory">Copying the files to kubernetes directory</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cp kube-controller-manager.crt kube-controller-manager.key kube-controller-manager.kubeconfig ca.key /var/lib/kubernetes/
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="configuring-systemd-service-file" data-heading="Configuring SystemD service file:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="configuring-systemd-service-file">Configuring SystemD service file:</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /etc/systemd/system/kube-controller-manager.service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes Controller Manager
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://github.com/kubernetes/kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/usr/local/bin/kube-controller-manager \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--bind-address=0.0.0.0 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-cluster-ip-range=10.32.0.0/24 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cluster-cidr=10.200.0.0/16 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--kubeconfig=/var/lib/kubernetes/kube-controller-manager.kubeconfig \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--authentication-kubeconfig=/var/lib/kubernetes/kube-controller-manager.kubeconfig \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--authorization-kubeconfig=/var/lib/kubernetes/kube-controller-manager.kubeconfig \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--leader-elect=true \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cluster-signing-cert-file=/var/lib/kubernetes/ca.crt \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cluster-signing-key-file=/var/lib/kubernetes/ca.key \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--root-ca-file=/var/lib/kubernetes/ca.crt \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-account-private-key-file=/var/lib/kubernetes/service-account.key \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--use-service-account-credentials=true \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--v=2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RestartSec=5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="start-controller-manager" data-heading="Start Controller Manager:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="start-controller-manager">Start Controller Manager:</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cp /root/binaries/kubernetes/server/bin/kube-controller-manager /usr/local/bin
</span></span><span style="display:flex;"><span>systemctl start kube-controller-manager
</span></span><span style="display:flex;"><span>systemctl status kube-controller-manager
</span></span><span style="display:flex;"><span>systemctl enable kube-controller-manager
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="configuring-scheduler" data-heading="Configuring Scheduler" data-level="3" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h3 id="configuring-scheduler">Configuring Scheduler</h3><!-- end-chunk -->
<!-- begin-chunk data-anchor="generate-certificates-1" data-heading="Generate Certificates:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="generate-certificates-1">Generate Certificates:</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /root/certificates
</span></span><span style="display:flex;"><span>openssl genrsa -out kube-scheduler.key <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>openssl req -new -key kube-scheduler.key -subj <span style="color:#e6db74">&#34;/CN=system:kube-scheduler&#34;</span> -out kube-scheduler.csr
</span></span><span style="display:flex;"><span>openssl x509 -req -in kube-scheduler.csr -CA ca.crt -CAkey ca.key -CAcreateserial  -out kube-scheduler.crt -days <span style="color:#ae81ff">1000</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="generate-kubeconfig-file" data-heading="Generate Kubeconfig file:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="generate-kubeconfig-file">Generate Kubeconfig file:</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  kubectl config set-cluster kubernetes-from-scratch <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --certificate-authority<span style="color:#f92672">=</span>ca.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --server<span style="color:#f92672">=</span>https://127.0.0.1:6443 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>kube-scheduler.kubeconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  kubectl config set-credentials system:kube-scheduler <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --client-certificate<span style="color:#f92672">=</span>kube-scheduler.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --client-key<span style="color:#f92672">=</span>kube-scheduler.key <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>kube-scheduler.kubeconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  kubectl config set-context default <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --cluster<span style="color:#f92672">=</span>kubernetes-from-scratch <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --user<span style="color:#f92672">=</span>system:kube-scheduler <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>kube-scheduler.kubeconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  kubectl config use-context default --kubeconfig<span style="color:#f92672">=</span>kube-scheduler.kubeconfig
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="copy-the-scheduler-kubeconfig" data-heading="Copy the scheduler kubeconfig" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="copy-the-scheduler-kubeconfig">Copy the scheduler kubeconfig</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cp kube-scheduler.kubeconfig /var/lib/kubernetes/
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="configuring-systemd-service" data-heading="Configuring systemd service:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="configuring-systemd-service">Configuring systemd service:</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /etc/systemd/system/kube-scheduler.service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes Scheduler
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://github.com/kubernetes/kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/usr/local/bin/kube-scheduler \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --kubeconfig=/var/lib/kubernetes/kube-scheduler.kubeconfig \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --authentication-kubeconfig=/var/lib/kubernetes/kube-scheduler.kubeconfig \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --authorization-kubeconfig=/var/lib/kubernetes/kube-scheduler.kubeconfig \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --bind-address=127.0.0.1 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --leader-elect=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RestartSec=5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="verification" data-heading="Verification:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="verification">Verification:</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cp /root/binaries/kubernetes/server/bin/kube-scheduler /usr/local/bin
</span></span><span style="display:flex;"><span>systemctl start kube-scheduler
</span></span><span style="display:flex;"><span>systemctl status kube-scheduler
</span></span><span style="display:flex;"><span>systemctl enable kube-scheduler
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="validating-cluster-status" data-heading="Validating Cluster Status" data-level="3" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h3 id="validating-cluster-status">Validating Cluster Status</h3><!-- end-chunk -->
<!-- begin-chunk data-anchor="generate-certificate-for-administrator-user" data-heading="Generate Certificate for Administrator User" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="generate-certificate-for-administrator-user">Generate Certificate for Administrator User</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /root/certificates
</span></span><span style="display:flex;"><span>openssl genrsa -out admin.key <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>openssl req -new -key admin.key -subj <span style="color:#e6db74">&#34;/CN=admin/O=system:masters&#34;</span> -out admin.csr
</span></span><span style="display:flex;"><span>openssl x509 -req -in admin.csr -CA ca.crt -CAkey ca.key -CAcreateserial  -out admin.crt -days <span style="color:#ae81ff">1000</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="create-kubeconfig-file" data-heading="Create KubeConfig file:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="create-kubeconfig-file">Create KubeConfig file:</h4><p>Note: Replace the IP address from the below snippet in line 5 with your IP address.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  kubectl config set-cluster kubernetes-from-scratch <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --certificate-authority<span style="color:#f92672">=</span>ca.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --server<span style="color:#f92672">=</span>https://<span style="color:#e6db74">${</span>SERVER_IP<span style="color:#e6db74">}</span>:6443 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>admin.kubeconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  kubectl config set-credentials admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --client-certificate<span style="color:#f92672">=</span>admin.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --client-key<span style="color:#f92672">=</span>admin.key <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>admin.kubeconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  kubectl config set-context default <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --cluster<span style="color:#f92672">=</span>kubernetes-from-scratch <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --user<span style="color:#f92672">=</span>admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>admin.kubeconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  kubectl config use-context default --kubeconfig<span style="color:#f92672">=</span>admin.kubeconfig
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="verify-cluster-status" data-heading="Verify Cluster Status" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="verify-cluster-status">Verify Cluster Status</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl get componentstatuses --kubeconfig<span style="color:#f92672">=</span>admin.kubeconfig
</span></span><span style="display:flex;"><span>cp /root/certificates/admin.kubeconfig ~/.kube/config
</span></span><span style="display:flex;"><span>kubectl get componentstatuses
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="verify-kubernetes-objects-creation" data-heading="Verify Kubernetes Objects Creation" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="verify-kubernetes-objects-creation">Verify Kubernetes Objects Creation</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl create namespace test
</span></span><span style="display:flex;"><span>kubectl get namespace test -o yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl create secret generic prod-secret --from-literal<span style="color:#f92672">=</span>username<span style="color:#f92672">=</span>admin --from-literal<span style="color:#f92672">=</span>password<span style="color:#f92672">=</span>password123
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get secret
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="worker-node-configuration" data-heading="Worker Node Configuration" data-level="3" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h3 id="worker-node-configuration">Worker Node Configuration</h3><!-- end-chunk -->
<!-- begin-chunk data-anchor="configure-container-runtime-worker-node" data-heading="Configure Container Runtime. (WORKER NODE)" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="configure-container-runtime-worker-node">Configure Container Runtime. (WORKER NODE)</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /etc/modules-load.d/containerd.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">overlay
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">br_netfilter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>modprobe overlay
</span></span><span style="display:flex;"><span>modprobe br_netfilter
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.bridge.bridge-nf-call-iptables  = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.ip_forward                 = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sysctl --system
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>sudo dnf config<span style="color:#f92672">-</span>manager <span style="color:#f92672">--</span>add<span style="color:#f92672">-</span>repo https:<span style="color:#e6db74">//</span>download<span style="color:#f92672">.</span>docker<span style="color:#f92672">.</span>com<span style="color:#e6db74">/linux/c</span>entos<span style="color:#f92672">/</span>docker<span style="color:#f92672">-</span>ce<span style="color:#f92672">.</span>repo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dnf install <span style="color:#f92672">-</span>y containerd<span style="color:#f92672">.</span>io
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mkdir <span style="color:#f92672">-</span>p <span style="color:#e6db74">/etc/co</span>ntainerd
</span></span><span style="display:flex;"><span>containerd config default <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">/etc/co</span>ntainerd<span style="color:#f92672">/</span>config<span style="color:#f92672">.</span>toml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>nano /etc/containerd/config.toml
</span></span></code></pre></div><p>&ndash;&gt; SystemdCgroup = true</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>systemctl restart containerd
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sudo sysctl --system
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="pre-requisites---2-worker-node" data-heading="Pre-Requisites - 2: (WORKER NODE)" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="pre-requisites---2-worker-node">Pre-Requisites - 2: (WORKER NODE)</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dnf install socat conntrack ipset
</span></span><span style="display:flex;"><span>sysctl -w net.ipv4.conf.all.forwarding<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>cd  /root/binaries/kubernetes/node/bin/
</span></span><span style="display:flex;"><span>cp kube-proxy kubectl kubelet /usr/local/bin
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="generate-kubelet-certificate-for-worker-node-master-node" data-heading="Generate Kubelet Certificate for Worker Node. (MASTER NODE)" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="generate-kubelet-certificate-for-worker-node-master-node">Generate Kubelet Certificate for Worker Node. (MASTER NODE)</h4><p>Note:</p>
<ol>
<li>Replace the IP Address and Hostname field in the below configurations according to your enviornement.</li>
<li>Run this in the Kubernetes Master Node</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /root/certificates
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat &gt; openssl-worker.example.com.cnf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[req]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">req_extensions = v3_req
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">distinguished_name = req_distinguished_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[req_distinguished_name]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ v3_req ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basicConstraints = CA:FALSE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">keyUsage = nonRepudiation, digitalSignature, keyEncipherment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjectAltName = @alt_names
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[alt_names]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DNS.1 = worker.example.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IP.1 = 172.16.16.111
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>openssl genrsa -out worker.example.com.key <span style="color:#ae81ff">2048</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>openssl req -new -key worker.example.com.key -subj <span style="color:#e6db74">&#34;/CN=system:node:worker.example.com/O=system:nodes&#34;</span> -out worker.example.com.csr -config openssl-worker.example.com.cnf
</span></span><span style="display:flex;"><span>openssl x509 -req -in worker.example.com.csr -CA ca.crt -CAkey ca.key -CAcreateserial  -out worker.example.com.crt -extensions v3_req -extfile openssl-worker.example.com.cnf -days <span style="color:#ae81ff">1000</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="step-2-generate-kube-proxy-certificate-master-node" data-heading="Step 2: Generate kube-proxy certificate: (MASTER NODE)" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="step-2-generate-kube-proxy-certificate-master-node">Step 2: Generate kube-proxy certificate: (MASTER NODE)</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>openssl genrsa -out kube-proxy.key <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>openssl req -new -key kube-proxy.key -subj <span style="color:#e6db74">&#34;/CN=system:kube-proxy&#34;</span> -out kube-proxy.csr
</span></span><span style="display:flex;"><span>openssl x509 -req -in kube-proxy.csr -CA ca.crt -CAkey ca.key -CAcreateserial  -out kube-proxy.crt -days <span style="color:#ae81ff">1000</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="step-3-copy-certificates-to-worker-node" data-heading="Step 3: Copy Certificates to Worker Node:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="step-3-copy-certificates-to-worker-node">Step 3: Copy Certificates to Worker Node:</h4><p>This can either be manual approach or via SCP.
Certificates: kubelet, kube-proxy and CA certificate.</p>
<p>In-case you want to automate it, then following configuration can be used.
In the demo, we had made used of manual way.</p>
<p>In-case, you want to transfer file from master to worker node, then you can make use of the following approach:</p>
<!-- end-chunk -->
<!-- begin-chunk data-anchor="--worker-node" data-heading="- Worker Node:" data-level="5" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h5 id="--worker-node">- Worker Node:</h5><!-- end-chunk -->
<!-- begin-chunk data-anchor="--master-node" data-heading="- Master Node:" data-level="5" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h5 id="--master-node">- Master Node:</h5><ul>
<li>Copy certificate from master node to worker nodes</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>scp kube-proxy.crt kube-proxy.key worker.example.com.key worker.example.com.crt ca.crt vagrant@172.16.16.111:/tmp
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="--worker-node-1" data-heading="- Worker Node:" data-level="5" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h5 id="--worker-node-1">- Worker Node:</h5><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir /root/certificates
</span></span><span style="display:flex;"><span>cd /tmp
</span></span><span style="display:flex;"><span>mv kube-proxy.crt kube-proxy.key worker.example.com.crt worker.example.com.key ca.crt /root/certificates
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="step-4-move-certificates-to-specific-location-worker-node" data-heading="Step 4: Move Certificates to Specific Location. (WORKER NODE)" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="step-4-move-certificates-to-specific-location-worker-node">Step 4: Move Certificates to Specific Location. (WORKER NODE)</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir /var/lib/kubernetes
</span></span><span style="display:flex;"><span>cd /root/certificates
</span></span><span style="display:flex;"><span>cp ca.crt /var/lib/kubernetes
</span></span><span style="display:flex;"><span>mkdir /var/lib/kubelet
</span></span><span style="display:flex;"><span>mv worker.example.com.crt  worker.example.com.key  kube-proxy.crt  kube-proxy.key /var/lib/kubelet/
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="step-5-generate-kubelet-configuration-yaml-file-worker-node" data-heading="Step 5: Generate Kubelet Configuration YAML File: (WORKER NODE)" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="step-5-generate-kubelet-configuration-yaml-file-worker-node">Step 5: Generate Kubelet Configuration YAML File: (WORKER NODE)</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /var/lib/kubelet/kubelet-config.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: KubeletConfiguration
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: kubelet.config.k8s.io/v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">authentication:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  anonymous:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    enabled: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  webhook:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  x509:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      clientCAFile: &#34;/var/lib/kubernetes/ca.crt&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">authorization:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  mode: Webhook
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">clusterDomain: &#34;cluster.local&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">clusterDNS:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - &#34;10.32.0.10&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">runtimeRequestTimeout: &#34;15m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cgroupDriver: systemd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="step-6-generate-systemd-service-file-for-kubelet-worker-node" data-heading="Step 6: Generate Systemd service file for kubelet: (WORKER NODE)" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="step-6-generate-systemd-service-file-for-kubelet-worker-node">Step 6: Generate Systemd service file for kubelet: (WORKER NODE)</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /etc/systemd/system/kubelet.service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes Kubelet
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://github.com/kubernetes/kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=containerd.service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Requires=containerd.service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/usr/local/bin/kubelet \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --config=/var/lib/kubelet/kubelet-config.yaml \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --container-runtime-endpoint=unix:///var/run/containerd/containerd.sock \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --kubeconfig=/var/lib/kubelet/kubeconfig \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --v=2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RestartSec=5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="step-7-generate-the-kubeconfig-file-for-kubelet-worker-node" data-heading="Step 7: Generate the Kubeconfig file for Kubelet (WORKER NODE)" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="step-7-generate-the-kubeconfig-file-for-kubelet-worker-node">Step 7: Generate the Kubeconfig file for Kubelet (WORKER NODE)</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /var/lib/kubelet
</span></span><span style="display:flex;"><span>cp /var/lib/kubernetes/ca.crt .
</span></span><span style="display:flex;"><span>SERVER_IP<span style="color:#f92672">=</span>IP-OF-API-SERVER
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  kubectl config set-cluster kubernetes-from-scratch <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --certificate-authority<span style="color:#f92672">=</span>ca.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --server<span style="color:#f92672">=</span>https://<span style="color:#e6db74">${</span>SERVER_IP<span style="color:#e6db74">}</span>:6443 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>worker.example.com.kubeconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  kubectl config set-credentials system:node:worker.example.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --client-certificate<span style="color:#f92672">=</span>worker.example.com.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --client-key<span style="color:#f92672">=</span>worker.example.com.key <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>worker.example.com.kubeconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  kubectl config set-context default <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --cluster<span style="color:#f92672">=</span>kubernetes-from-scratch <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --user<span style="color:#f92672">=</span>system:node:worker.example.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>worker.example.com.kubeconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  kubectl config use-context default --kubeconfig<span style="color:#f92672">=</span>worker.example.com.kubeconfig
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mv worker.example.com.kubeconfig kubeconfig
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="part-2---kube-proxy" data-heading="Part 2 - Kube-Proxy" data-level="3" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h3 id="part-2---kube-proxy">Part 2 - Kube-Proxy</h3><!-- end-chunk -->
<!-- begin-chunk data-anchor="step-1-copy-kube-proxy-certificate-to-directory--worker-node" data-heading="Step 1: Copy Kube Proxy Certificate to Directory:  (WORKER NODE)" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="step-1-copy-kube-proxy-certificate-to-directory--worker-node">Step 1: Copy Kube Proxy Certificate to Directory:  (WORKER NODE)</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir /var/lib/kube-proxy
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="step-2-generate-kubeconfig-file" data-heading="Step 2: Generate KubeConfig file:" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="step-2-generate-kubeconfig-file">Step 2: Generate KubeConfig file:</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  kubectl config set-cluster kubernetes-from-scratch <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --certificate-authority<span style="color:#f92672">=</span>ca.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --server<span style="color:#f92672">=</span>https://<span style="color:#e6db74">${</span>SERVER_IP<span style="color:#e6db74">}</span>:6443 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>kube-proxy.kubeconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  kubectl config set-credentials system:kube-proxy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --client-certificate<span style="color:#f92672">=</span>kube-proxy.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --client-key<span style="color:#f92672">=</span>kube-proxy.key <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>kube-proxy.kubeconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  kubectl config set-context default <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --cluster<span style="color:#f92672">=</span>kubernetes-from-scratch <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --user<span style="color:#f92672">=</span>system:kube-proxy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --kubeconfig<span style="color:#f92672">=</span>kube-proxy.kubeconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  kubectl config use-context default --kubeconfig<span style="color:#f92672">=</span>kube-proxy.kubeconfig
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mv kube-proxy.kubeconfig /var/lib/kube-proxy/kubeconfig
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="step-3-generate-kube-proxy-configuration-file-worker-node" data-heading="Step 3: Generate kube-proxy configuration file: (WORKER NODE)" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="step-3-generate-kube-proxy-configuration-file-worker-node">Step 3: Generate kube-proxy configuration file: (WORKER NODE)</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /var/lib/kube-proxy
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /var/lib/kube-proxy/kube-proxy-config.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: KubeProxyConfiguration
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: kubeproxy.config.k8s.io/v1alpha1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">clientConnection:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  kubeconfig: &#34;/var/lib/kube-proxy/kubeconfig&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mode: &#34;iptables&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">clusterCIDR: &#34;10.200.0.0/16&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="step-4-create-kube-proxy-service-file-worker-node" data-heading="Step 4: Create kube-proxy service file: (WORKER NODE)" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="step-4-create-kube-proxy-service-file-worker-node">Step 4: Create kube-proxy service file: (WORKER NODE)</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /etc/systemd/system/kube-proxy.service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes Kube Proxy
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://github.com/kubernetes/kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/usr/local/bin/kube-proxy \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --config=/var/lib/kube-proxy/kube-proxy-config.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RestartSec=5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="worker-node" data-heading="WORKER NODE" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="worker-node">WORKER NODE</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>systemctl start kubelet
</span></span><span style="display:flex;"><span>systemctl start kube-proxy
</span></span><span style="display:flex;"><span>systemctl enable kubelet
</span></span><span style="display:flex;"><span>systemctl enable kube-proxy
</span></span></code></pre></div><!-- end-chunk -->
<!-- begin-chunk data-anchor="step-6-master-node" data-heading="Step 6: (MASTER NODE)" data-level="4" data-permalink="/docs/kubernetes/docs/miscellaneous/kuberneteshardway/" data-title="Kubernets Installation From Scatch on rocky 9" -->
<h4 id="step-6-master-node">Step 6: (MASTER NODE)</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl get nodes
</span></span></code></pre></div><ul>
<li>Check the log of kubelet</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-t" data-lang="t"><span style="display:flex;"><span>journalctl <span style="color:#f92672">-</span>u kubelet<span style="color:#f92672">.</span>service
</span></span></code></pre></div>
	
	
	
</div>


          </main>
        </div>
      </div>
      
    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>




















<script src="/js/main.min.223ab2fcc7d742c1b94772c0276851c497da4343cd2d21534199ced90681e207.js" integrity="sha256-Ijqy/MfXQsG5R3LAJ2hRxJfaQ0PNLSFTQZnO2QaB4gc=" crossorigin="anonymous"></script>



<script src='/js/prism.js'></script>



  </body>
</html>